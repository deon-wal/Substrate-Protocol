<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUBSTRATE // ARCH_03: ORBITAL_LIVING_SYSTEM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Jura:wght@300;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-void: #020204;
            --panel-bg: rgba(6, 6, 8, 0.96);
            --neon-blue: #0ea5e9;
            --neon-violet: #8b5cf6;
            --neon-orange: #f97316;
            --threat-red: #ef4444;
            --text-main: #cbd5e1;
            --text-dim: #334155;
            --border: rgba(14, 165, 233, 0.15);
            --glitch-offset: 0px;
            --header-h: 110px;
            --footer-h: 90px;
        }

        * { box-sizing: border-box; cursor: crosshair; }

        body {
            background-color: var(--bg-void);
            color: var(--text-main);
            font-family: 'Jura', sans-serif;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            display: grid;
            grid-template-rows: var(--header-h) 1fr var(--footer-h);
            /* Diegetic Lens Distortion */
            transform: perspective(1000px) rotateX(0.1deg) scale(1.02);
        }

        /* --- BACKGROUND LAYERS --- */
        .hex-background {
            position: fixed; inset: 0; pointer-events: none; z-index: 1;
            opacity: 0.04; font-size: 10px; line-height: 12px;
            overflow: hidden; color: var(--neon-blue); white-space: pre;
            font-family: 'Space Mono', monospace;
        }
        .hex-scroll-inner { animation: scroll-up 180s linear infinite; }
        @keyframes scroll-up { from { transform: translateY(0); } to { transform: translateY(-50%); } }

        canvas#particle-canvas {
            position: fixed; inset: 0; pointer-events: none; z-index: 2;
        }

        /* --- ATMOSPHERICS --- */
        .atmospherics {
            position: fixed; inset: 0; pointer-events: none; z-index: 5000;
            background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.7) 100%);
            box-shadow: inset 0 0 100px rgba(0,0,0,0.8);
        }
        .scanlines {
            position: fixed; inset: 0; pointer-events: none; z-index: 5001;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%);
            background-size: 100% 4px;
        }

        /* --- HEADER --- */
        header {
            background: #000; border-bottom: 2px solid var(--border);
            display: flex; flex-direction: column; z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,1);
        }
        .header-top {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 40px; height: 60px; border-bottom: 1px solid rgba(14, 165, 233, 0.05);
        }
        .header-nav {
            display: flex; align-items: center; padding: 0 40px; height: 50px; gap: 5px;
            background: rgba(14, 165, 233, 0.02); overflow-x: auto; scrollbar-width: none;
        }
        .header-nav::-webkit-scrollbar { display: none; }

        .logo-text { font-family: 'Audiowide', cursive; font-size: 1.5rem; color: #fff; letter-spacing: -1px; }
        .alert-tag { color: var(--threat-red); font-size: 0.6rem; border: 1px solid var(--threat-red); padding: 2px 8px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.2; } }

        nav a { 
            color: var(--text-dim); text-decoration: none; font-size: 0.65rem; border: 1px solid transparent; 
            padding: 6px 14px; transition: 0.2s; white-space: nowrap; text-transform: uppercase; font-weight: bold;
        }
        nav a:hover, nav a.active { color: #fff; border-color: var(--neon-blue); background: rgba(14, 165, 233, 0.1); }

        /* --- VIEWPORT --- */
        .viewport {
            display: grid; grid-template-columns: 380px 1fr 340px; overflow: hidden; position: relative; z-index: 100;
        }

        aside {
            background: var(--panel-bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; position: relative;
        }
        .panel-header {
            padding: 12px 15px; border-bottom: 1px solid var(--border);
            font-size: 0.6rem; color: var(--neon-blue); display: flex; justify-content: space-between;
            text-transform: uppercase; letter-spacing: 3px; background: rgba(14, 165, 233, 0.05);
        }

        /* --- SUBJECT AUDIT FEED --- */
        #subject-stream { flex: 1; overflow-y: auto; scrollbar-width: none; }
        .subject-card {
            padding: 12px 15px; border-bottom: 1px solid rgba(255,255,255,0.02);
            display: flex; gap: 12px; align-items: center; position: relative; transition: 0.3s;
        }
        .subject-img { width: 35px; height: 35px; border: 1px solid var(--border); filter: grayscale(1) brightness(0.6); }
        .subject-bio { flex: 1; overflow: hidden; }
        .subject-name { font-size: 0.8rem; font-weight: 700; color: #fff; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .heat-map { height: 15px; width: 60px; background: #000; position: relative; }
        
        .critical-state { 
            border-left: 3px solid var(--threat-red); background: rgba(239, 68, 68, 0.1);
            box-shadow: inset 0 0 15px rgba(239, 68, 68, 0.2);
            animation: threat-glow 2s infinite;
        }
        @keyframes threat-glow { 0%, 100% { border-color: var(--threat-red); } 50% { border-color: #fff; } }

        /* --- ORBITAL FOCUS (CENTER) --- */
        .orbital-view {
            position: relative; background: radial-gradient(circle at center, #111827 0%, #000 100%);
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .ring-wireframe {
            position: absolute; width: 85%; height: 85%; stroke: var(--neon-blue); stroke-width: 0.2; fill: none; opacity: 0.2;
            transform: rotateX(65deg) rotateZ(0deg); animation: ring-rotate 100s linear infinite;
        }
        @keyframes ring-rotate { to { transform: rotateX(65deg) rotateZ(360deg); } }

        .decoherence-marker {
            position: absolute; width: 20px; height: 20px;
            background: var(--threat-red); border-radius: 50%;
            filter: blur(8px); left: 35%; top: 75%; /* 7 o'clock */
            animation: pulse-deco 1.5s infinite alternate;
        }
        @keyframes pulse-deco { from { opacity: 0.2; transform: scale(0.8); } to { opacity: 1; transform: scale(1.5); } }

        .stability-display {
            position: absolute; top: 40px; text-align: center; z-index: 500;
        }
        .stability-label { font-size: 0.6rem; color: var(--neon-blue); letter-spacing: 5px; margin-bottom: 5px; }
        .stability-value {
            font-family: 'Audiowide', cursive; font-size: 5rem; color: #fff; line-height: 1;
            text-shadow: calc(var(--glitch-offset) * -1) 0 0 rgba(255,0,0,0.8),
                         var(--glitch-offset) 0 0 rgba(0,255,255,0.8);
            transition: 0.1s;
        }

        .teacup-evidence {
            position: absolute; bottom: 80px; right: 30px; width: 130px; height: 130px;
            border: 1px solid var(--border); background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .teacup-icon { width: 50px; height: 50px; stroke: #fff; fill: none; opacity: 0.5; animation: cup-physics 6s infinite; }
        @keyframes cup-physics { 50% { transform: translateY(-20px) rotate(30deg); opacity: 1; } }

        /* --- TERMINAL --- */
        .terminal {
            height: 180px; background: #000; border-top: 2px solid var(--border);
            padding: 12px; font-size: 0.6rem; color: #4ade80; display: flex; flex-direction: column-reverse; gap: 4px; overflow: hidden;
        }
        .jitter-alert { display: inline-block; animation: jitter 0.1s infinite; color: var(--threat-red); }
        @keyframes jitter { 50% { transform: translate(1.5px, -1.5px); } }

        /* --- FOOTER: KINETIC DECK --- */
        footer {
            background: #000; border-top: 2px solid var(--border);
            display: grid; grid-template-columns: 1fr 2fr 1fr; align-items: center; padding: 0 40px; z-index: 1000;
        }
        .footer-sec { display: flex; align-items: center; gap: 30px; }
        .deck-sliders { flex: 1; display: flex; gap: 20px; justify-content: center; }
        .slider-wrap { display: flex; flex-direction: column; gap: 5px; width: 150px; }
        .slider-label { font-size: 0.5rem; color: var(--neon-blue); letter-spacing: 1px; }
        
        input[type=range] { appearance: none; background: #111; height: 3px; accent-color: var(--neon-blue); outline: none; }

        .greeble { position: absolute; font-size: 4px; color: var(--text-dim); text-transform: uppercase; pointer-events: none; }

    </style>
</head>
<body id="substrate-hud">

    <div class="hex-background" id="hex-container"></div>
    <canvas id="particle-canvas"></canvas>
    <div class="scanlines"></div>
    <div class="atmospherics"></div>

    <header>
        <div class="header-top">
            <div class="logo-block">
                <div class="logo-text">SUBSTRATE // ARCH_03</div>
                <div class="alert-tag">STABILITY_RECOVERY_MODE</div>
            </div>
            <div id="clock" style="font-size: 1.2rem; font-weight: 900; color: var(--neon-blue); font-family: 'Space Mono';">00:00:00</div>
        </div>
        <div class="header-nav">
            <nav>
                <a href="index.html">DASHBOARD</a>
                <a href="spire.html">SPIRE</a>
                <a href="market.html">MARKET</a>
                <a href="residential.html" class="active">RESIDENTIAL</a>
                <a href="observatory.html">OBSERVATORY</a>
                <a href="sync.html">SYNC</a>
                <a href="deck.html">DECK</a>
                <a href="login.html">AUTH</a>
                <a href="backdoor.html" style="opacity: 0.2;">_ROOT</a>
            </nav>
        </div>
    </header>

    <div class="viewport">
        <!-- LEFT: SUBJECT AUDIT -->
        <aside>
            <div class="panel-header">
                <div class="greeble tl">AUDIT_PROTOCOL_X</div>
                <span>Subject_Audit_Registry</span>
                <span id="subject-count">0</span>
            </div>
            <div id="subject-stream"></div>
            <div class="terminal" id="terminal">
                <div>[SYSTEM] INITIALIZING ORBITAL_HUD_v5...</div>
            </div>
        </aside>

        <!-- CENTER: ORBITAL WIREFRAME -->
        <main class="orbital-view" id="main-view">
            <div class="greeble tl" style="top:20px; left:20px;">COORD: 44.02 // -12.90</div>
            <div class="greeble tr" style="top:20px; right:20px;">LENS_CURVE: 0.002%</div>
            
            <svg class="ring-wireframe" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="48" stroke-dasharray="1, 4" />
                <circle cx="50" cy="50" r="38" stroke-dasharray="10, 5" />
                <path d="M50 5 L50 15 M50 85 L50 95 M5 50 L15 50 M85 50 L95 50" />
                <circle cx="50" cy="50" r="5" fill="var(--neon-blue)" opacity="0.1" />
            </svg>

            <div class="decoherence-marker"></div>

            <div class="stability-display">
                <div class="stability-label">STABILITY_COEFFICIENT</div>
                <div class="stability-value" id="stab-val">99.9%</div>
            </div>

            <div class="teacup-evidence">
                <div class="greeble tl">KINETIC_EVIDENCE_S01</div>
                <svg class="teacup-icon" viewBox="0 0 100 100">
                    <path d="M25,40 Q25,85 50,85 Q75,85 75,40 Z" stroke-width="3"/>
                    <path d="M75,45 Q90,45 90,55 Q90,65 75,65" stroke-width="3"/>
                </svg>
                <div style="font-size: 0.5rem; color: #fff; margin-top: 5px;">VAR: PROJECTILE</div>
            </div>

            <div style="position: absolute; bottom: 60px; width: 450px; text-align: center;">
                <div style="font-size: 0.5rem; color: var(--neon-violet); letter-spacing: 2px;">SLOANE_DIRECTIVE_FEED</div>
                <div id="narrative-feed" style="font-size: 0.85rem; color: #fff; height: 1.2em; font-weight: bold; text-transform: uppercase; margin-top: 5px;"></div>
            </div>
        </main>

        <!-- RIGHT: TELEMETRY -->
        <aside style="border-right: none; border-left: 1px solid var(--border);">
            <div class="panel-header">
                <span>Biometric_Vitals</span>
                <span style="color: var(--neon-orange);">LIVE</span>
            </div>
            <div style="padding: 20px; display: flex; flex-direction: column; gap: 20px;">
                <div style="border: 1px solid var(--border); padding: 12px; background: rgba(0,0,0,0.3);">
                    <div class="v-label" style="font-size:0.5rem; color:var(--text-dim);">O2_TAX_INDEX</div>
                    <div id="o2-val" style="font-size: 1.4rem; color: #fff;">₮ 0.0000</div>
                </div>
                <div style="border: 1px solid var(--border); padding: 12px; background: rgba(0,0,0,0.3);">
                    <div class="v-label" style="font-size:0.5rem; color:var(--text-dim);">MASS_DENSITY_G</div>
                    <div id="mass-val" style="font-size: 1.4rem; color: #fff;">1.002 G</div>
                </div>
                <div style="border: 1px solid var(--border); padding: 12px; background: rgba(0,0,0,0.3);">
                    <div class="v-label" style="font-size:0.5rem; color:var(--text-dim);">ACOUSTIC_VOICE_FEED</div>
                    <canvas id="voice-canvas" style="width: 100%; height: 60px; margin-top: 10px;"></canvas>
                </div>
                <div style="border: 1px solid var(--threat-red); padding: 12px; background: rgba(220, 38, 38, 0.05);">
                    <div class="v-label" style="font-size:0.5rem; color:var(--threat-red);">SECTOR_DEBT</div>
                    <div style="font-size: 1.4rem; color: var(--threat-red); font-weight: 900;">$ 42.2M</div>
                </div>
            </div>
        </aside>
    </div>

    <footer>
        <div class="footer-sec">
            <span>BITRATE: 44.1KBPS</span>
            <span>OS: v4.4.2_STABLE</span>
        </div>
        <div class="footer-sec deck-sliders">
            <div class="slider-wrap">
                <div class="slider-label">FREQUENCY_STAB</div>
                <input type="range" id="f_in" min="10" max="100" value="20">
            </div>
            <div class="slider-wrap">
                <div class="slider-label">AMPLITUDE_MOD</div>
                <input type="range" id="a_in" min="1" max="100" value="30">
            </div>
            <div class="slider-wrap">
                <div class="slider-label">PHASE_SYNC</div>
                <input type="range" id="p_in" min="1" max="100" value="50">
            </div>
        </div>
        <div class="footer-sec" style="justify-content: flex-end;">
            <span>PACKET_SYNC: 99.4%</span>
            <span style="color: var(--neon-blue); margin-left: 20px;">RING_03_SECURED</span>
        </div>
    </footer>

    <script>
        // --- 1. HEX BG GENERATOR ---
        const hexContainer = document.getElementById('hex-container');
        let hexString = "";
        for(let i=0; i<3000; i++) hexString += Math.floor(Math.random()*16).toString(16) + (i % 30 === 0 ? "\n" : " ");
        hexContainer.innerHTML = `<div class="hex-scroll-inner">${hexString}${hexString}</div>`;

        // --- 2. PARTICLE DUST MOTES ---
        const pCanvas = document.getElementById('particle-canvas');
        const pCtx = pCanvas.getContext('2d');
        let particles = [];
        
        function initParticles() {
            pCanvas.width = window.innerWidth;
            pCanvas.height = window.innerHeight;
            particles = [];
            for(let i=0; i<50; i++) {
                particles.push({
                    x: Math.random() * pCanvas.width,
                    y: Math.random() * pCanvas.height,
                    s: Math.random() * 2,
                    v: Math.random() * 0.5 + 0.1
                });
            }
        }

        function drawParticles() {
            pCtx.clearRect(0,0,pCanvas.width, pCanvas.height);
            pCtx.fillStyle = "rgba(255,255,255,0.05)";
            particles.forEach(p => {
                pCtx.beginPath();
                pCtx.arc(p.x, p.y, p.s, 0, Math.PI*2);
                pCtx.fill();
                p.y -= p.v;
                if(p.y < -10) p.y = pCanvas.height + 10;
            });
            requestAnimationFrame(drawParticles);
        }

        // --- 3. DATA STREAM ---
        const stream = document.getElementById('subject-stream');
        const terminal = document.getElementById('terminal');
        const stabVal = document.getElementById('stab-val');
        let currentStability = 99.9;
        const targetWave = { f: 42, a: 60, p: 25 };

        async function initData() {
            try {
                const res = await fetch('https://randomuser.me/api/?results=15&nat=us');
                const data = await res.json();
                renderSubjects(data.results);
                requestAnimationFrame(mainLoop);
            } catch(e) {
                terminal.innerHTML = "<div class='jitter-alert'>[FATAL] SUBSTRATE LINK FAILED.</div>";
            }
        }

        function renderSubjects(users) {
            stream.innerHTML = users.map((u, i) => {
                const isCritical = (u.name.last === "Flores" || i === 4);
                return `
                    <div class="subject-card ${isCritical ? 'critical-state' : ''}" id="s-${i}">
                        <img class="subject-img" src="${u.picture.thumbnail}">
                        <div class="subject-bio">
                            <span class="subject-name" style="${isCritical ? 'color: var(--threat-red)' : ''}">${u.name.last.toUpperCase()}, ${u.name.first[0]}.</span>
                            <span class="subject-unit">CID_${Math.floor(Math.random()*9000)} // ${isCritical ? 'CRITICAL' : 'STABLE'}</span>
                            <div class="heat-map"><canvas class="h-canvas" id="h-${i}" style="width:100%; height:100%"></canvas></div>
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('subject-count').innerText = `${users.length} SUBJECTS_FOUND`;
            initHeatMaps();
        }

        // --- 4. WAVEFORM & LOOP ---
        const vCanvas = document.getElementById('voice-canvas');
        const vCtx = vCanvas.getContext('2d');
        let waveTime = 0;

        function mainLoop() {
            waveTime += 0.1;
            const f = parseInt(document.getElementById('f_in').value);
            const a = parseInt(document.getElementById('a_in').value);
            const p = parseInt(document.getElementById('p_in').value);

            // Accuracy logic
            const distF = Math.abs(f - targetWave.f);
            const distA = Math.abs(a - targetWave.a);
            const accuracy = 100 - (distF + distA);
            currentStability = (currentStability * 0.95) + (accuracy * 0.05);
            stabVal.innerText = currentStability.toFixed(1) + "%";

            // Glitch Intensity
            const glitch = Math.max(0, (98 - currentStability) * 4);
            document.documentElement.style.setProperty('--glitch-offset', `${glitch}px`);

            // Draw Vitals Wave
            vCtx.clearRect(0,0,vCanvas.width, vCanvas.height);
            vCtx.beginPath();
            vCtx.strokeStyle = currentStability < 92 ? 'var(--threat-red)' : 'var(--neon-blue)';
            vCtx.lineWidth = 1;
            for(let x=0; x<vCanvas.width; x++) {
                const stress = (100 - currentStability) * 2;
                const y = 30 + Math.sin(x*0.1 + waveTime) * 10 + (Math.random()*stress - stress/2);
                vCtx.lineTo(x, y);
            }
            vCtx.stroke();

            // Random Alerts
            if(currentStability < 90 && Math.random() > 0.98) {
                logTerminal(`STABILITY FAILURE: Higgs-Decoherence Spike detected`, true);
            }

            requestAnimationFrame(mainLoop);
        }

        function initHeatMaps() {
            const hCanvases = document.querySelectorAll('.h-canvas');
            hCanvases.forEach(hc => {
                const ctx = hc.getContext('2d');
                function drawH() {
                    const isCrit = hc.parentElement.parentElement.parentElement.classList.contains('critical-state');
                    ctx.clearRect(0,0,hc.width, hc.height);
                    ctx.beginPath();
                    ctx.strokeStyle = isCrit ? 'var(--threat-red)' : 'var(--neon-blue)';
                    ctx.lineWidth = 1;
                    for(let x=0; x<hc.width; x+=2) {
                        const y = hc.height/2 + (Math.random()* (isCrit ? 10 : 4) - (isCrit ? 5 : 2));
                        ctx.lineTo(x, y);
                    }
                    ctx.stroke();
                    setTimeout(drawH, 100 + Math.random()*200);
                }
                drawH();
            });
        }

        function logTerminal(msg, isAlert = false) {
            const div = document.createElement('div');
            if(isAlert) div.className = "jitter-alert";
            div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            terminal.prepend(div);
            if(terminal.childNodes.length > 8) terminal.lastChild.remove();
        }

        // --- 5. NARRATIVE ---
        const lines = [
            "THE TEA CUP SHOULDN'T ACCELERATE LIKE A PROJECTILE.",
            "SLOANE VIEWS HUMAN SUFFERING AS A NECESSARY BYPRODUCT.",
            "THE SPIRE IS DECOHERING. THE CITY IS HUNGRY.",
            "A PERFECTLY SMOOTH WALL WHERE A DOOR USED TO BE.",
            "INTERVENTION ALTERS THE DATASET.",
            "SUBJECT 01 RECOGNIZED THE LOOP."
        ];
        let lIdx = 0, cIdx = 0;
        function type() {
            const el = document.getElementById('narrative-feed');
            if(cIdx < lines[lIdx].length) {
                el.innerText += lines[lIdx][cIdx++];
                setTimeout(type, 50);
            } else {
                setTimeout(() => { el.innerText = ""; cIdx = 0; lIdx = (lIdx + 1) % lines.length; type(); }, 3000);
            }
        }

        // INIT
        window.addEventListener('resize', initParticles);
        initParticles();
        drawParticles();
        initData();
        type();
        vCanvas.width = vCanvas.offsetWidth;
        vCanvas.height = vCanvas.offsetHeight;
        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString();
            document.getElementById('o2-val').innerText = `₮ ${(Math.random()*0.005).toFixed(4)}`;
            document.getElementById('mass-val').innerText = (1 + Math.random()*0.02).toFixed(3) + " G";
        }, 1000);

    </script>
</body>
</html>

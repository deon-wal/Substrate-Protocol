<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // OBSERVATORY_LENS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020205;
            --panel: rgba(15, 15, 20, 0.8);
            --border: rgba(139, 92, 246, 0.2); /* Violet Border */
            --violet: #8b5cf6;
            --crimson: #ef4444;
            --void: #a78bfa;
        }

        body {
            background-color: var(--bg);
            color: var(--void);
            font-family: 'Share Tech Mono', monospace;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- STARFIELD BG --- */
        #starfield { position: fixed; inset: 0; z-index: -1; }

        /* --- HEADER --- */
        header {
            height: 60px;
            background: rgba(2, 2, 5, 0.95);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px; z-index: 10;
        }
        .logo { color: var(--violet); font-size: 1.2rem; letter-spacing: 2px; text-shadow: 0 0 10px var(--violet); }
        .nav a { color: #555; text-decoration: none; margin-left: 20px; transition: 0.3s; }
        .nav a:hover { color: #fff; }
        .nav a.active { color: var(--violet); border-bottom: 1px solid var(--violet); }

        /* --- MAIN LAYOUT --- */
        .viewport {
            flex: 1;
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            padding: 20px;
        }

        /* PANELS */
        .panel {
            background: var(--panel);
            border: 1px solid var(--border);
            padding: 20px;
            display: flex; flex-direction: column;
            backdrop-filter: blur(5px);
        }
        .p-title {
            color: #fff; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px;
            font-size: 0.8rem; letter-spacing: 1px;
        }

        /* --- CENTER: SIGNAL SCOPE --- */
        .scope-container {
            position: relative;
            background: radial-gradient(circle at center, #1a1033 0%, #000 90%);
            border: 1px solid var(--border);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            overflow: hidden;
        }
        
        #signal-canvas { width: 100%; height: 100%; }

        .scope-overlay {
            position: absolute; top: 20px; left: 20px; pointer-events: none;
        }
        .status-txt { font-size: 1.5rem; color: var(--crimson); font-weight: bold; text-shadow: 0 0 10px var(--crimson); }
        
        /* --- CONTROLS --- */
        .control-deck {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(0,0,0,0.9);
            border-top: 1px solid var(--border);
            padding: 20px;
            display: flex; gap: 30px; justify-content: center;
            box-sizing: border-box;
        }
        
        .knob-group { text-align: center; width: 150px; }
        .knob-label { display: block; color: #888; font-size: 0.7rem; margin-bottom: 5px; }
        
        input[type=range] {
            width: 100%; accent-color: var(--violet); cursor: pointer;
        }

        /* --- RIGHT: DECODER OUTPUT --- */
        #decode-screen {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem; color: var(--violet);
            line-height: 1.5;
            white-space: pre-wrap;
        }
        .locked { color: #444; filter: blur(2px); user-select: none; }
        .unlocked { color: #fff; filter: none; animation: flash 0.5s; }
        @keyframes flash { 0% { background: #fff; } 100% { background: transparent; } }

    </style>
</head>
<body>

    <canvas id="starfield"></canvas>

    <header>
        <div class="logo">ALDERSYTH // OBSERVATORY</div>
        <nav class="nav">
            <a href="spire.html">CORE</a>
            <a href="market.html">MARKET</a>
            <a href="residential.html">RESIDENTIAL</a>
            <a href="observatory.html" class="active">OBSERVATORY</a>
            <a href="sync.html">SYNC</a>
            <a href="backdoor.html" style="opacity:0.3;">_ROOT</a>
        </nav>
        <div style="font-size:0.7rem;">VECTOR_CRISIS: <span style="color:var(--crimson)">ACTIVE</span></div>
    </header>

    <div class="viewport">
        
        <aside class="panel">
            <div class="p-title">HIGGS_FIELD_SENSORS</div>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.8rem;">
                <span>VECTOR_X</span> <span id="val-x">0.00</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.8rem;">
                <span>VECTOR_Y</span> <span id="val-y">0.00</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.8rem;">
                <span>ENTROPY</span> <span style="color:var(--crimson)">CRITICAL</span>
            </div>
            <div style="margin-top:auto; font-size:0.7rem; color:#666;">
                > SCANNING VOID SECTOR...<br>
                > UNKNOWN CARRIER WAVE DETECTED.<br>
                > ATTEMPTING HANDSHAKE...
            </div>
        </aside>

        <main class="scope-container">
            <canvas id="signal-canvas"></canvas>
            
            <div class="scope-overlay">
                <div style="font-size:0.7rem; color:var(--violet);">TARGET: THE_STRANGERS</div>
                <div id="signal-status" class="status-txt">NO SIGNAL</div>
                <div style="font-size:0.7rem; color:#888;">MATCH THE WAVEFORMS TO DECRYPT</div>
            </div>

            <div class="control-deck">
                <div class="knob-group">
                    <span class="knob-label">FREQUENCY</span>
                    <input type="range" min="1" max="100" value="50" id="freq-slider">
                </div>
                <div class="knob-group">
                    <span class="knob-label">AMPLITUDE</span>
                    <input type="range" min="1" max="100" value="10" id="amp-slider">
                </div>
                <div class="knob-group">
                    <span class="knob-label">PHASE_SHIFT</span>
                    <input type="range" min="1" max="100" value="1" id="phase-slider">
                </div>
            </div>
        </main>

        <aside class="panel">
            <div class="p-title">DECODED_TRANSMISSION</div>
            <div id="decode-screen" class="locked">
                [ENCRYPTED DATA STREAM]
                01010101010101010
                ...
                SIGNAL STRENGTH TOO LOW.
                ...
                ALIGN VECTORS TO RESOLVE MESSAGE.
            </div>
        </aside>

    </div>

    <script>
        // --- 1. STARFIELD BACKGROUND ---
        const starCanvas = document.getElementById('starfield');
        const sCtx = starCanvas.getContext('2d');
        
        function resizeStars() { starCanvas.width = window.innerWidth; starCanvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeStars);
        resizeStars();

        let stars = Array(100).fill().map(() => ({
            x: Math.random() * starCanvas.width,
            y: Math.random() * starCanvas.height,
            z: Math.random() * 2,
            o: Math.random()
        }));

        function drawStars() {
            sCtx.clearRect(0,0,starCanvas.width, starCanvas.height);
            sCtx.fillStyle = "#fff";
            stars.forEach(s => {
                s.x -= s.z * 0.1;
                if(s.x < 0) s.x = starCanvas.width;
                sCtx.globalAlpha = s.o;
                sCtx.beginPath(); sCtx.arc(s.x, s.y, s.z, 0, Math.PI*2); sCtx.fill();
            });
            requestAnimationFrame(drawStars);
        }
        drawStars();

        // --- 2. SIGNAL TUNER GAME ---
        const sigCanvas = document.getElementById('signal-canvas');
        const ctx = sigCanvas.getContext('2d');
        
        // Game State
        let targetFreq = Math.floor(Math.random() * 60) + 20; // Random target
        let targetAmp = Math.floor(Math.random() * 60) + 20;
        let targetPhase = Math.floor(Math.random() * 80) + 10;
        
        let time = 0;
        let isLocked = false;

        // Resize Signal Canvas
        function resizeSig() {
            sigCanvas.width = sigCanvas.parentElement.offsetWidth;
            sigCanvas.height = sigCanvas.parentElement.offsetHeight;
        }
        window.addEventListener('resize', resizeSig);
        resizeSig();

        function drawSignal() {
            ctx.clearRect(0,0,sigCanvas.width, sigCanvas.height);
            time += 0.1;

            // Get User Inputs
            const userFreq = parseInt(document.getElementById('freq-slider').value);
            const userAmp = parseInt(document.getElementById('amp-slider').value);
            const userPhase = parseInt(document.getElementById('phase-slider').value);

            // Draw "Target" Wave (Ghostly Red)
            // We animate the target slightly so it feels alive ("Drift")
            drawWave(targetFreq, targetAmp, targetPhase, "rgba(239, 68, 68, 0.4)", 2);

            // Draw "User" Wave (Bright Violet)
            drawWave(userFreq, userAmp, userPhase, "rgba(139, 92, 246, 1)", 3);

            // Check Win Condition
            // We give a small margin of error (tolerance)
            const fDiff = Math.abs(userFreq - targetFreq);
            const aDiff = Math.abs(userAmp - targetAmp);
            const pDiff = Math.abs(userPhase - targetPhase);

            if(fDiff < 5 && aDiff < 10 && pDiff < 10) {
                if(!isLocked) lockSignal();
            } else {
                if(isLocked) loseSignal();
            }

            // Simulated Telemetry Noise
            document.getElementById('val-x').innerText = (Math.random()).toFixed(4);
            document.getElementById('val-y').innerText = (Math.random()).toFixed(4);

            requestAnimationFrame(drawSignal);
        }

        function drawWave(freq, amp, phase, color, width) {
            ctx.beginPath();
            ctx.lineWidth = width;
            ctx.strokeStyle = color;
            
            const centerY = sigCanvas.height / 2;
            
            for(let x = 0; x < sigCanvas.width; x++) {
                // Wave Math: y = Amp * sin(Freq * x + Phase + Time)
                const y = centerY + (amp * 1.5) * Math.sin((x * freq * 0.002) + (phase * 0.1) + time);
                if(x===0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
        }

        function lockSignal() {
            isLocked = true;
            const status = document.getElementById('signal-status');
            const screen = document.getElementById('decode-screen');
            
            status.innerText = "SIGNAL LOCKED";
            status.style.color = "#14b8a6"; // Teal
            status.style.textShadow = "0 0 20px #14b8a6";

            // Reveal Message
            screen.className = "unlocked";
            screen.innerHTML = `
<strong style="color:#fff">SOURCE: THE_CROW_UNIT_7</strong>
<br><br>
"We are not attacking. We are trying to warn you.
The geometry isn't broken; it's being edited.
<br>
Sloane knows. Look at the timestamps in the Market logs.
The 'Drift' isn't random. It's a countdown."
<br><br>
<span style="color:var(--crimson)">END TRANSMISSION.</span>
            `;
        }

        function loseSignal() {
            isLocked = false;
            const status = document.getElementById('signal-status');
            const screen = document.getElementById('decode-screen');
            
            status.innerText = "NO SIGNAL";
            status.style.color = "#ef4444"; // Crimson
            status.style.textShadow = "0 0 10px #ef4444";

            screen.className = "locked";
            screen.innerHTML = "[ENCRYPTED DATA STREAM]\nALIGN VECTORS TO RESOLVE...";
        }

        drawSignal();

    </script>
</body>
</html>

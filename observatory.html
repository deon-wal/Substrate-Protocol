<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // OBSERVATORY_LENS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #020205;
            --panel: rgba(15, 15, 20, 0.9);
            --border: rgba(139, 92, 246, 0.3);
            --violet: #8b5cf6;
            --crimson: #ef4444;
            --cyan: #06b6d4;
        }

        body {
            background-color: var(--bg);
            color: var(--violet);
            font-family: 'Share Tech Mono', monospace;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- STARFIELD BG --- */
        #starfield { position: fixed; inset: 0; z-index: -1; }

        /* --- HEADER --- */
        header {
            height: 60px;
            background: rgba(2, 2, 5, 0.95);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px; z-index: 10;
        }
        .nav a { color: #555; text-decoration: none; margin-left: 20px; transition: 0.3s; }
        .nav a:hover { color: #fff; }
        .nav a.active { color: var(--violet); border-bottom: 1px solid var(--violet); }

        /* --- START OVERLAY --- */
        #start-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            z-index: 999; display: flex; align-items: center; justify-content: center;
            flex-direction: column; backdrop-filter: blur(5px);
        }
        .start-btn {
            background: transparent; border: 2px solid var(--violet); color: var(--violet);
            padding: 20px 40px; font-family: inherit; font-size: 1.2rem; cursor: pointer;
            transition: 0.2s; letter-spacing: 2px;
        }
        .start-btn:hover { background: var(--violet); color: #000; box-shadow: 0 0 30px var(--violet); }

        /* --- MAIN LAYOUT --- */
        .viewport {
            flex: 1;
            display: grid;
            grid-template-columns: 280px 1fr 280px;
            gap: 1px;
            background: var(--border); /* Gap color */
        }

        .panel {
            background: var(--panel);
            padding: 20px;
            display: flex; flex-direction: column;
        }

        /* --- SCOPE --- */
        .scope-container {
            position: relative;
            background: radial-gradient(circle at center, #1a1033 0%, #000 90%);
            display: flex; flex-direction: column;
            overflow: hidden;
        }
        #signal-canvas { width: 100%; height: 100%; }
        
        .scope-hud {
            position: absolute; top: 20px; left: 20px; pointer-events: none;
        }
        .status-txt { font-size: 2rem; font-weight: bold; margin-top: 5px; transition: 0.3s; }

        /* --- CONTROLS --- */
        .control-deck {
            background: #000; border-top: 1px solid var(--border);
            padding: 20px; display: flex; gap: 20px; justify-content: center;
        }
        .slider-group { text-align: center; flex: 1; max-width: 200px; }
        .label { font-size: 0.7rem; color: #888; display: block; margin-bottom: 5px; }
        
        input[type=range] { width: 100%; accent-color: var(--violet); cursor: pointer; }

        /* --- DECODER --- */
        #decode-screen {
            font-size: 0.8rem; color: #fff; line-height: 1.6; white-space: pre-wrap;
            opacity: 0.5; transition: 1s;
        }
        .locked { filter: blur(4px); pointer-events: none; }
        .unlocked { filter: none; opacity: 1; text-shadow: 0 0 10px var(--cyan); }

        /* --- AUDIO VISUALIZER BARS --- */
        .vu-meter {
            height: 4px; background: #333; margin-top: 5px; position: relative;
        }
        .vu-fill {
            height: 100%; width: 0%; background: var(--violet); transition: width 0.1s;
        }

    </style>
</head>
<body>

    <canvas id="starfield"></canvas>

    <div id="start-overlay">
        <div style="margin-bottom: 20px; color:#fff;">WARNING: AUDIO OUTPUT DETECTED</div>
        <button class="start-btn" onclick="initSystem()">INITIALIZE_SYSTEMS</button>
    </div>

    <header>
        <div class="logo">ALDERSYTH // OBSERVATORY</div>
        <nav class="nav">
            <a href="spire.html">CORE</a>
            <a href="market.html">MARKET</a>
            <a href="residential.html">RESIDENTIAL</a>
            <a href="observatory.html" class="active">OBSERVATORY</a>
            <a href="sync.html">SYNC</a>
            <a href="backdoor.html" style="opacity:0.3;">_ROOT</a>
        </nav>
    </header>

    <div class="viewport">
        <aside class="panel">
            <div style="color:#fff; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:15px;">SENSOR_ARRAY</div>
            
            <div style="margin-bottom: 20px;">
                <span class="label">SIGNAL_STRENGTH</span>
                <div class="vu-meter"><div class="vu-fill" id="vu-sig"></div></div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <span class="label">BACKGROUND_RADIATION</span>
                <div class="vu-meter"><div class="vu-fill" id="vu-bg" style="background:var(--crimson)"></div></div>
            </div>

            <div style="margin-top:auto; font-size:0.7rem; color:#666;">
                > LISTENING TO SECTOR 7...<br>
                > AUDIO OUTPUT: <span id="audio-status">OFFLINE</span>
            </div>
        </aside>

        <main class="scope-container">
            <canvas id="signal-canvas"></canvas>
            <div class="scope-hud">
                <div style="color:var(--violet); font-size:0.8rem;">TARGET: UNKNOWN_ENTITY</div>
                <div id="lock-status" class="status-txt" style="color:var(--crimson)">SEARCHING...</div>
            </div>

            <div class="control-deck">
                <div class="slider-group">
                    <span class="label">FREQUENCY (PITCH)</span>
                    <input type="range" min="10" max="100" value="50" id="freq">
                </div>
                <div class="slider-group">
                    <span class="label">AMPLITUDE (GAIN)</span>
                    <input type="range" min="1" max="100" value="20" id="amp">
                </div>
                <div class="slider-group">
                    <span class="label">PHASE (PAN)</span>
                    <input type="range" min="1" max="100" value="10" id="phase">
                </div>
            </div>
        </main>

        <aside class="panel">
            <div style="color:#fff; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:15px;">DECRYPTED_LOG</div>
            <div id="decode-screen" class="locked">
                [ENCRYPTED SIGNAL]
                ------------------
                0x994FA... ERROR
                0x112B3... ERROR
                ------------------
                MATCH WAVEFORM TO DECRYPT
            </div>
        </aside>
    </div>

    <script>
        // --- 1. SETUP ---
        const cvs = document.getElementById('signal-canvas');
        const ctx = cvs.getContext('2d');
        const starCvs = document.getElementById('starfield');
        const starCtx = starCvs.getContext('2d');

        let audioCtx, osc, gainNode, panner;
        let isRunning = false;
        let time = 0;
        let lockTimer = 0;

        // Target (The "Ghost" Wave)
        const target = { freq: 45, amp: 60, phase: 50 };

        function resize() {
            cvs.width = cvs.parentElement.offsetWidth;
            cvs.height = cvs.parentElement.offsetHeight;
            starCvs.width = window.innerWidth;
            starCvs.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // --- 2. AUDIO SYSTEM ---
        function initSystem() {
            document.getElementById('start-overlay').style.display = 'none';
            document.getElementById('audio-status').innerText = "ONLINE";
            document.getElementById('audio-status').style.color = "var(--violet)";
            
            // Web Audio Init
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            osc = audioCtx.createOscillator();
            gainNode = audioCtx.createGain();
            panner = audioCtx.createStereoPanner();

            osc.type = 'sine'; // Sci-fi drone sound
            osc.frequency.value = 200;
            gainNode.gain.value = 0.1;

            osc.connect(panner);
            panner.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();

            isRunning = true;
            loop();
        }

        // --- 3. STARS (Reactive) ---
        let stars = Array(100).fill().map(() => ({
            x: Math.random() * window.innerWidth,
            y: Math.random() * window.innerHeight,
            z: Math.random() * 2
        }));

        function drawStars(shake) {
            starCtx.clearRect(0,0,starCvs.width, starCvs.height);
            starCtx.fillStyle = "#fff";
            stars.forEach(s => {
                s.x -= 0.2; 
                if(s.x < 0) s.x = starCvs.width;
                
                // Shake effect based on Amplitude
                let dx = (Math.random() - 0.5) * shake;
                let dy = (Math.random() - 0.5) * shake;

                starCtx.beginPath();
                starCtx.arc(s.x + dx, s.y + dy, s.z * 0.8, 0, Math.PI*2);
                starCtx.fill();
            });
        }

        // --- 4. MAIN LOOP ---
        function loop() {
            if(!isRunning) return;
            requestAnimationFrame(loop);
            
            time += 0.1;
            ctx.clearRect(0,0,cvs.width, cvs.height);

            // Get Inputs
            const freqVal = parseInt(document.getElementById('freq').value);
            const ampVal = parseInt(document.getElementById('amp').value);
            const phaseVal = parseInt(document.getElementById('phase').value);

            // Update Audio
            if(audioCtx) {
                // Map 0-100 inputs to audio values
                osc.frequency.setTargetAtTime(100 + (freqVal * 5), audioCtx.currentTime, 0.1);
                gainNode.gain.setTargetAtTime(ampVal * 0.005, audioCtx.currentTime, 0.1);
                panner.pan.setTargetAtTime((phaseVal - 50) / 50, audioCtx.currentTime, 0.1);
            }

            // Update VU Meters
            document.getElementById('vu-sig').style.width = ampVal + "%";
            document.getElementById('vu-bg').style.width = (Math.random() * 20) + "%";

            // Draw Target Wave (Red)
            drawWave(target.freq, target.amp, target.phase, "rgba(239, 68, 68, 0.3)", 2);

            // Draw User Wave (Violet)
            drawWave(freqVal, ampVal, phaseVal, "#8b5cf6", 3);

            // Check Lock
            const fDiff = Math.abs(freqVal - target.freq);
            const aDiff = Math.abs(ampVal - target.amp);
            const pDiff = Math.abs(phaseVal - target.phase);

            if(fDiff < 5 && aDiff < 10 && pDiff < 10) {
                lockTimer++;
            } else {
                lockTimer = Math.max(0, lockTimer - 2);
            }

            updateLockState(lockTimer);
            
            // Stars react to volume (ampVal)
            drawStars(ampVal * 0.1); 
        }

        function drawWave(f, a, p, color, width) {
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            
            let centerY = cvs.height / 2;
            for(let x=0; x<cvs.width; x++) {
                // Math: sin( frequency + phase + time ) * amplitude
                let y = centerY + Math.sin(x * f * 0.002 + p * 0.1 + time) * (a * 2);
                if(x===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.stroke();
        }

        function updateLockState(timer) {
            const status = document.getElementById('lock-status');
            const screen = document.getElementById('decode-screen');

            if(timer > 50) { // Locked
                status.innerText = "SIGNAL LOCKED";
                status.style.color = "#06b6d4"; // Cyan
                status.style.textShadow = "0 0 20px #06b6d4";
                
                screen.className = "unlocked";
                screen.innerHTML = `
<span style="color:#06b6d4">SOURCE: [UNKNOWN_ORIGIN]</span>
<br><br>
"The Market is a distraction.
The Spire is a cage.
<br>
The 'Data' isn't money. It's memory.
They are mining our memories to build a bridge."
<br><br>
> COORDINATES RECEIVED: SECTOR_NULL.
                `;
            } else { // Searching
                status.innerText = "SEARCHING...";
                status.style.color = "#ef4444";
                status.style.textShadow = "none";
                
                screen.className = "locked";
                screen.innerHTML = "[ENCRYPTED DATA STREAM]\nALIGN VECTORS TO RESOLVE...";
            }
        }

    </script>
</body>
</html>

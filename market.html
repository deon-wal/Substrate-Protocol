<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // MARKET_FLUX</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* --- SUBSTRATE THEME: RUST / OCHRE / HEAT --- */
        :root {
            --bg: #050200;
            --panel: rgba(15, 5, 0, 0.95);
            --rust: #ea580c;       
            --ochre: #d97706;
            --heat: #ffedd5;       
            --alert: #ef4444;      
            --green: #22c55e;
            --grid-line: rgba(234, 88, 12, 0.2);
        }

        * { box-sizing: border-box; user-select: none; }
        
        body { 
            margin: 0; background: var(--bg); color: var(--ochre);
            font-family: 'Share Tech Mono', monospace; overflow: hidden;
            height: 100vh; width: 100vw;
            background-image: url('images/market_thumbnail.jpg'); 
            background-size: cover; background-attachment: fixed;
            background-blend-mode: multiply;
        }

        /* --- HEAT HAZE FX --- */
        #heat-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 5;
            backdrop-filter: blur(1px); opacity: 0; transition: opacity 0.5s;
        }
        @keyframes haze {
            0% { transform: translate(0,0) scale(1); }
            50% { transform: translate(-2px, -2px) scale(1.01); filter: hue-rotate(-5deg); }
            100% { transform: translate(0,0) scale(1); }
        }
        body.critical #heat-overlay { opacity: 1; animation: haze 0.1s infinite; }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1a0500; border-left: 1px solid #333; }
        ::-webkit-scrollbar-thumb { background: var(--rust); border: 1px solid #555; }
        ::-webkit-scrollbar-thumb:hover { background: var(--heat); }

        /* --- LAYOUT ARCHITECTURE --- */
        .layout-grid {
            display: grid;
            grid-template-rows: 60px 40px 1fr; /* Nav, Ticker, Main Content */
            height: 100vh;
            width: 100vw;
        }

        /* --- 1. NAV BAR --- */
        .nav-bar {
            background: linear-gradient(180deg, #000 90%, transparent 100%);
            border-bottom: 1px solid var(--rust);
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 30px; z-index: 100;
        }
        .logo { font-family: 'Rajdhani'; font-size: 1.8rem; letter-spacing: 4px; color: #fff; text-shadow: 0 0 15px var(--rust); }
        .nav { display: flex; gap: 20px; }
        .nav a { 
            color: #888; text-decoration: none; font-size: 0.9rem; letter-spacing: 2px; transition: 0.3s; font-weight: bold;
        }
        .nav a:hover { color: var(--heat); text-shadow: 0 0 10px var(--rust); }
        .nav a.active { color: var(--rust); border-bottom: 2px solid var(--rust); }
        .nav a.root { color: var(--alert); }

        /* --- 2. TICKER TAPE --- */
        .ticker-bar {
            background: rgba(40, 10, 0, 0.9); border-bottom: 1px solid var(--rust);
            overflow: hidden; display: flex; align-items: center; white-space: nowrap;
        }
        .ticker-content {
            display: inline-block;
            animation: scroll-left 160s linear infinite; /* Slowed down for readability */
            font-size: 1.2rem; color: var(--heat); font-weight: bold; letter-spacing: 2px;
            padding-left: 100%; text-shadow: 0 0 5px var(--rust);
        }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- 3. MAIN DASHBOARD --- */
        .dashboard {
            display: grid;
            grid-template-columns: 350px 1fr 400px;
            gap: 20px;
            padding: 20px;
            overflow: hidden;
            height: 100%; /* Ensure it fills the grid row */
        }

        /* PANELS */
        .panel {
            background: rgba(10, 5, 0, 0.85); border: 1px solid var(--rust);
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); backdrop-filter: blur(5px);
        }
        .p-header {
            background: rgba(234, 88, 12, 0.1); border-bottom: 1px solid var(--rust);
            padding: 10px 15px; font-size: 0.8rem; color: #fff; font-weight: bold;
            display: flex; justify-content: space-between;
        }

        /* --- LEFT: ORDER BOOK --- */
        .order-book { flex: 1; overflow-y: auto; font-family: 'Share Tech Mono'; font-size: 0.85rem; }
        .order-row { 
            display: grid; grid-template-columns: 1fr 1fr 1fr; padding: 6px 10px; 
            border-bottom: 1px solid rgba(234, 88, 12, 0.2); 
        }
        .order-row:nth-child(even) { background: rgba(255,255,255,0.02); }
        .order-row:hover { background: rgba(234, 88, 12, 0.2); color: #fff; }
        .price-up { color: var(--green); }
        .price-down { color: var(--alert); }
        .vol { text-align: right; color: #666; }

        /* --- CENTER: HACKED LIVE FEED --- */
        .vortex-container { 
            position: relative; width: 100%; height: 100%; 
            background: #000; border: 1px solid #333; overflow: hidden;
        }
        
        /* The Hacked Camera Feed */
        .live-feed-bg {
            position: absolute; inset: 0;
            background-image: url('images/log2.jpg');
            background-size: cover; background-position: center;
            opacity: 0.6; filter: grayscale(0.5) contrast(1.2);
            z-index: 0;
            animation: signal-noise 4s infinite;
        }
        
        /* Scanline Overlay on Camera */
        .feed-overlay {
            position: absolute; inset: 0; 
            background: linear-gradient(rgba(0,0,0,0) 50%, rgba(0,0,0,0.25) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 1;
        }

        #three-canvas { position: absolute; inset: 0; width: 100%; height: 100%; filter: contrast(1.2); z-index: 2; mix-blend-mode: screen; }

        .overlay-ui {
            position: absolute; top: 20px; left: 20px; pointer-events: none; z-index: 10;
            color: var(--alert); font-size: 0.9rem; font-weight: bold; text-shadow: 0 0 5px #000;
            background: rgba(0,0,0,0.8); padding: 5px 10px; border: 1px solid var(--alert);
            animation: blink 2s infinite;
        }

        .cam-label {
            position: absolute; bottom: 20px; right: 20px; z-index: 10;
            color: #fff; background: rgba(0,0,0,0.8); padding: 5px; font-size: 0.7rem;
        }

        @keyframes signal-noise {
            0% { opacity: 0.6; transform: translateX(0); }
            5% { opacity: 0.5; transform: translateX(2px); }
            10% { opacity: 0.6; transform: translateX(0); }
            95% { opacity: 0.6; }
            96% { opacity: 0.4; filter: invert(1); }
            100% { opacity: 0.6; filter: invert(0); }
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* --- RIGHT: THE GUTTER --- */
        .feed-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 2px; }
        .feed-item {
            padding: 12px; border-bottom: 1px dashed #333; background: rgba(0,0,0,0.4);
            font-size: 0.85rem; line-height: 1.4; color: #ccc;
        }
        .feed-item:hover { background: rgba(234, 88, 12, 0.15); color: #fff; }
        .user { color: var(--ochre); font-weight: bold; font-size: 0.7rem; margin-right: 5px; }
        .time { float: right; color: #555; font-size: 0.7rem; }

        /* --- CONTROLS --- */
        .control-box { padding: 15px; border-top: 1px solid var(--rust); background: rgba(0,0,0,0.8); }
        .big-temp { font-family: 'Rajdhani'; font-size: 3rem; color: #fff; line-height: 1; text-align: center; margin-bottom: 10px; }
        
        .btn-vent {
            width: 100%; background: #2a0a00; border: 1px solid var(--rust); color: var(--rust);
            padding: 12px; font-family: inherit; font-size: 1.2rem; font-weight: bold; cursor: pointer;
            transition: 0.2s; text-transform: uppercase;
        }
        .btn-vent:hover { background: var(--rust); color: #000; box-shadow: 0 0 30px var(--rust); }

        /* HEAT FX */
        #heat-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 50;
            backdrop-filter: blur(2px) hue-rotate(-10deg); opacity: 0; transition: opacity 1s;
        }
        body.critical #heat-overlay { opacity: 1; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 0.2; } 100% { opacity: 0.5; } }

    </style>
</head>
<body>

    <div id="heat-overlay"></div>

    <div class="layout-grid">
        
        <!-- ROW 1: NAV -->
        <div class="nav-bar">
            <div class="logo">ALDERSYTH // MARKET</div>
            <nav class="nav">
                <a href="index.html">CORE</a>
                <a href="spire.html">SPIRE</a>
                <a href="market.html" class="active">MARKET</a>
                <a href="residential.html">RESIDENTIAL</a>
                <a href="observatory.html">OBSERVATORY</a>
                <a href="sync.html">SYNC</a>
                <a href="login.html" class="root">_ROOT</a>
            </nav>
        </div>

        <!-- ROW 2: TICKER -->
        <div class="ticker-bar">
            <div class="ticker-content" id="ticker-tape">LOADING GLOBAL EXCHANGE DATA...</div>
        </div>

        <!-- ROW 3: MAIN CONTENT -->
        <div class="dashboard">
            
            <!-- COL 1: ORDER BOOK -->
            <div class="panel">
                <div class="p-header"><span>COMMODITY_L2</span><span>LIVE_FEED</span></div>
                <div class="order-book" id="order-book">
                    <!-- JS fills this -->
                </div>
            </div>

            <!-- COL 2: HACKED LIVE FEED -->
            <div class="panel" style="border:none; background:none; box-shadow:none;">
                <div class="vortex-container">
                    <div class="live-feed-bg"></div>
                    <div class="feed-overlay"></div>
                    <canvas id="three-canvas"></canvas>
                    
                    <div class="overlay-ui">
                        ● LIVE FEED // CAM_04<br>
                        SOURCE: VERA_GHOST_PROTOCOL<br>
                        LOCATION: SUB-STRATA
                    </div>

                    <div class="cam-label">
                        [REC] 00:04:12 // THERMAL_CAM
                    </div>
                </div>
            </div>

            <!-- COL 3: THE GUTTER -->
            <div class="panel">
                <div class="p-header"><span>CITIZEN_NET // THE_GUTTER</span><span style="color:var(--green)">● ONLINE</span></div>
                <div class="feed-list" id="feed-list">
                    <!-- JS fills this -->
                </div>
                
                <!-- CONTROLS AT BOTTOM OF FEED -->
                <div class="control-box">
                    <div class="big-temp" id="temp-val">482°K</div>
                    <input type="range" min="0" max="100" value="30" style="width:100%; accent-color:var(--rust); margin-bottom:10px;" id="pressure-slider">
                    <button class="btn-vent" onclick="ventSteam()">EMERGENCY VENT</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 1. MEGA TICKER DATA ---
        const tickerItems = [
            "BTC: $42,109 ▲", "ETH: $3,105 ▼", "O2_CAN: ₮450 ▲", "WATER: ₮1,200 ▲", 
            "LEAD: ₮85 ▼", "GRAV_D: ₮5,400 ▲", "DATA_S: ₮300 ▲", "MELON: ₮45 ▼", 
            "COFFEE: ₮890 ▲", "HEAT_S: ₮210 ▼", "VERA_COIN: ₮1.05 ▲", "OLD_OS: ₮5,000 ▲",
            "BIO_MESH: ₮670 ▼", "SLUDGE: ₮12 ▲", "N2_LIQ: ₮340 ▼", "MEM_FRAG: ₮9,999 ▲",
            "VOID_KEY: ₮0.00 --", "PORK_SYNTH: ₮22 ▼", "TUNGSTEN: ₮1,500 ▲", "GRAPHENE: ₮2,100 ▲"
        ];
        
        function initTicker() {
            // Repeat the string multiple times to ensure it fills the width before scrolling
            const text = tickerItems.join(" /// ") + " /// " + tickerItems.join(" /// ") + " /// " + tickerItems.join(" /// ");
            document.getElementById('ticker-tape').innerText = text;
        }
        initTicker();

        // --- 2. ORDER BOOK SIMULATION ---
        const commodities = [
            "O2_CAN", "H2O_FLT", "LEAD_KG", "GRAV_D", "DATA_S", "MELON", 
            "COFFEE", "HEAT_S", "V_COIN", "OLD_OS", "BIO_MS", "SLUDGE", "N2_LIQ"
        ];

        function updateOrderBook() {
            const container = document.getElementById('order-book');
            container.innerHTML = ""; // Refresh
            
            // Generate 30 rows
            for(let i=0; i<30; i++) {
                let sym = commodities[Math.floor(Math.random() * commodities.length)];
                let price = (Math.random() * 1000).toFixed(2);
                let size = Math.floor(Math.random() * 500);
                let type = Math.random() > 0.5 ? 'price-up' : 'price-down';
                let arrow = type === 'price-up' ? '▲' : '▼';
                
                let row = document.createElement('div');
                row.className = "order-row";
                row.innerHTML = `<span>${sym}</span><span class="${type} col-right">${arrow} ${price}</span><span class="vol">${size}</span>`;
                container.appendChild(row);
            }
        }
        setInterval(updateOrderBook, 3000); // 3 second updates for readability

        // --- 3. THE GUTTER (REDDIT SCRAPER) ---
        const forumUsers = ["Rat_King", "Echo_Loco", "Sloane_Eye", "Market_Rat", "Null_Set", "Vera_Fan", "Lead_Head", "Steam_Junkie", "Void_Walker", "Glitch_Bitch"];
        const forumPosts = [
            "The heat in Sector 4 is unbearable today. Even the rats are leaving.",
            "Buying O2 canisters, will trade for clean data.",
            "Did anyone else see the gravity glitch by the fountain?",
            "My neighbor's door disappeared. Smooth wall now.",
            "Selling 5kg of Lead. No questions asked.",
            "The steam vents are screaming.",
            "Don't look at the Observatory.",
            "Price of Water Filters just doubled.",
            "I found a memory shard in the gutter.",
            "Vera is watching. Always.",
            "The sludge is leaking again.",
            "Has anyone seen Bas? He was here yesterday.",
            "Need a new heat sink for my rig.",
            "Just saw a kid floating in zero-g.",
            "Radiation levels spiking.",
            "Who is buying all the Tungsten?",
            "The bridge isn't for us.",
            "My hands are glitching out.",
            "THERMAL LIMIT EXCEEDED IN SECTOR 9",
            "Anyone want to buy some fresh melon juice?"
        ];

        function addPost() {
            const feed = document.getElementById('feed-list');
            const u = forumUsers[Math.floor(Math.random() * forumUsers.length)];
            const p = forumPosts[Math.floor(Math.random() * forumPosts.length)];
            const upvotes = Math.floor(Math.random() * 500);
            
            const item = document.createElement('div');
            item.className = "feed-item";
            item.innerHTML = `<div class="post-meta"><span class="user">@${u}</span> <span class="time">NOW</span></div><div class="post-body">${p}</div>`;
            
            feed.prepend(item);
            if(feed.children.length > 50) feed.lastChild.remove();
        }
        setInterval(addPost, 4000); 
        for(let i=0; i<10; i++) addPost(); // Init

        // --- 4. 3D VORTEX (AR OVERLAY) ---
        let pressure = 30;
        const canvas = document.getElementById('three-canvas');
        const renderer = new THREE.WebGLRenderer({canvas, alpha:true});
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
        camera.position.z = 5;

        // Vortex Cylinder
        const geo = new THREE.CylinderGeometry(1.5, 1.5, 6, 32, 1, true);
        const mat = new THREE.MeshBasicMaterial({ 
            color: 0xffffff, wireframe: true, transparent: true, opacity: 0.15, side: THREE.DoubleSide 
        });
        const vortex = new THREE.Mesh(geo, mat);
        vortex.rotation.x = Math.PI/2;
        scene.add(vortex);

        // Core Ring
        const core = new THREE.Mesh(new THREE.TorusGeometry(1.2, 0.1, 16, 100), new THREE.MeshBasicMaterial({ color: 0xea580c }));
        scene.add(core);

        function resize() {
            const p = canvas.parentElement;
            renderer.setSize(p.clientWidth, p.clientHeight);
            camera.aspect = p.clientWidth / p.clientHeight;
            camera.updateProjectionMatrix();
        }
        window.addEventListener('resize', resize);
        resize();

        function animate() {
            requestAnimationFrame(animate);
            vortex.rotation.y += 0.001 * pressure;
            core.rotation.x += 0.002 * pressure;
            
            if(pressure > 85) {
                camera.position.x = (Math.random()-0.5) * 0.1;
                document.body.classList.add('critical');
            } else {
                camera.position.set(0,0,5);
                document.body.classList.remove('critical');
            }
            renderer.render(scene, camera);
            
            document.getElementById('temp-val').innerText = Math.floor(400 + (pressure*4)) + "°K";
        }
        animate();

        // --- CONTROLS ---
        const slider = document.getElementById('pressure-slider');
        slider.oninput = (e) => { pressure = parseInt(e.target.value); };

        function ventSteam() {
            pressure = Math.max(10, pressure - 20);
            slider.value = pressure;
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // MARKET_FLUX</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* --- SUBSTRATE THEME: RUST / OCHRE / HEAT --- */
        :root {
            --bg: #050200;
            --panel: rgba(20, 8, 0, 0.95);
            --rust: #ea580c;       
            --ochre: #d97706;
            --heat: #ffedd5;       
            --alert: #ef4444;      
            --green: #22c55e;
        }

        * { box-sizing: border-box; user-select: none; }
        
        body { 
            margin: 0; background: var(--bg); color: var(--ochre);
            font-family: 'Share Tech Mono', monospace; overflow: hidden;
            font-size: 14px;
            /* Asset: Market Thumbnail */
            background-image: url('images/market_thumbnail.jpg'); 
            background-size: cover; background-attachment: fixed;
            background-blend-mode: multiply;
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #110; }
        ::-webkit-scrollbar-thumb { background: var(--rust); }

        /* --- LAYOUT GRID --- */
        /* Increased sidebars for better readability */
        .interface {
            display: grid; grid-template-columns: 320px 1fr 350px;
            grid-template-rows: 100px 1fr; /* Header space reserved */
            height: 100vh; width: 100vw;
            position: relative; z-index: 20;
            padding: 0; /* Removing padding to force full fit */
        }

        /* --- HEADER & TICKER --- */
        header {
            grid-column: 1 / -1; /* Spans full width */
            background: linear-gradient(180deg, #000 90%, transparent 100%);
            border-bottom: 2px solid var(--rust);
            display: flex; flex-direction: column;
            justify-content: center;
            padding-top: 10px;
            z-index: 100;
        }
        
        .nav-bar {
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 40px; height: 50px;
        }
        .logo { font-family: 'Rajdhani'; font-size: 2rem; letter-spacing: 4px; color: #fff; text-shadow: 0 0 15px var(--rust); }
        
        .nav a { 
            color: #888; text-decoration: none; margin-left: 20px; font-size: 0.9rem; letter-spacing: 2px; transition: 0.3s; font-weight: bold;
        }
        .nav a:hover { color: var(--heat); text-shadow: 0 0 10px var(--rust); }
        .nav a.active { color: var(--rust); border-bottom: 2px solid var(--rust); }
        .nav a.root { color: var(--alert); }

        /* TICKER TAPE (SLOWED & LARGER) */
        .ticker-wrap {
            width: 100%; height: 40px; background: rgba(234, 88, 12, 0.15);
            overflow: hidden; display: flex; align-items: center; border-top: 1px solid #333;
        }
        .ticker {
            display: inline-block; white-space: nowrap; padding-left: 100%;
            /* Slowed down to 160s for readability */
            animation: scroll 160s linear infinite; 
            color: var(--heat); font-size: 1.2rem; letter-spacing: 2px; font-weight: bold;
            text-shadow: 0 0 5px var(--rust);
        }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- COLUMNS --- */
        .col-left, .col-right {
            display: flex; flex-direction: column; gap: 15px; 
            padding: 20px; overflow-y: hidden; height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
        }
        .col-center {
            position: relative; border-left: 1px solid var(--rust); border-right: 1px solid var(--rust);
            display: flex; flex-direction: column;
        }

        .panel {
            border: 1px solid var(--rust); background: var(--panel); 
            box-shadow: 0 0 20px rgba(0,0,0,0.8); position: relative;
            display: flex; flex-direction: column;
        }
        /* Make Order Book & Feed fill remaining space */
        .panel.fill { flex: 1; min-height: 0; } 

        .p-head { 
            font-size: 0.9rem; color: #fff; background: rgba(234, 88, 12, 0.2);
            padding: 8px 12px; display: flex; justify-content: space-between; font-weight: bold;
            border-bottom: 1px solid var(--rust);
        }

        /* --- THERMAL GAUGE --- */
        .metric-box { padding: 15px; text-align: center; }
        .big-val { font-family: 'Rajdhani'; font-size: 4rem; font-weight: bold; color: #fff; line-height: 1; text-shadow: 0 0 20px var(--alert); }
        .heat-bar { width: 100%; height: 10px; background: #311; margin-top: 10px; border: 1px solid #500; }
        .heat-fill { height: 100%; width: 40%; background: linear-gradient(90deg, var(--rust), #fff); transition: width 0.2s; box-shadow: 0 0 15px var(--rust); }

        /* --- CENTER VORTEX --- */
        #three-canvas { width: 100%; height: 100%; filter: contrast(1.4) brightness(1.1); }
        .overlay-ui {
            position: absolute; bottom: 30px; left: 30px; pointer-events: none;
            color: var(--heat); font-size: 1rem; font-weight: bold; text-shadow: 0 0 5px #000;
            background: rgba(0,0,0,0.7); padding: 10px; border: 1px solid var(--rust);
        }

        /* --- REDDIT FEED ("THE GUTTER") --- */
        .feed-container {
            flex: 1; overflow-y: auto; padding: 0; display: flex; flex-direction: column;
        }
        .post {
            padding: 12px; border-bottom: 1px solid #333;
            font-size: 0.85rem; transition: 0.2s; cursor: default;
            color: #ddd;
        }
        .post:hover { background: rgba(234, 88, 12, 0.15); color: #fff; }
        .post-meta { display: flex; justify-content: space-between; color: var(--rust); font-size: 0.75rem; margin-bottom: 4px; font-weight: bold;}
        
        /* --- ORDER BOOK --- */
        .order-book-container {
            font-family: 'Share Tech Mono'; font-size: 0.9rem;
            flex: 1; overflow-y: auto;
        }
        .order-row { 
            display: grid; grid-template-columns: 1fr 1fr 1fr; padding: 8px 10px; border-bottom: 1px solid #222; 
        }
        .order-row:nth-child(even) { background: rgba(255,255,255,0.02); }
        .order-row:hover { background: #221; color: #fff; }
        .price-up { color: var(--green); }
        .price-down { color: var(--alert); }
        .col-right { text-align: right; }

        /* --- CONTROLS --- */
        .btn-vent {
            width: 100%; background: #2a0a00; border: 1px solid var(--rust); color: var(--rust);
            padding: 15px; font-family: inherit; font-size: 1.2rem; font-weight: bold; cursor: pointer;
            transition: 0.2s; text-transform: uppercase; margin-top: 0;
        }
        .btn-vent:hover { background: var(--rust); color: #000; box-shadow: 0 0 30px var(--rust); }

        /* HEAT FX */
        #heat-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 5;
            backdrop-filter: blur(2px) hue-rotate(-10deg); opacity: 0; transition: opacity 1s;
        }
        body.critical #heat-overlay { opacity: 1; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 0.2; } 100% { opacity: 0.6; } }

    </style>
</head>
<body>

    <div id="heat-overlay"></div>

    <header>
        <div class="nav-bar">
            <div class="logo">ALDERSYTH // MARKET</div>
            <nav class="nav">
                <a href="index.html">CORE</a>
                <a href="spire.html">SPIRE</a>
                <a href="market.html" class="active">MARKET</a>
                <a href="residential.html">RESIDENTIAL</a>
                <a href="observatory.html">OBSERVATORY</a>
                <a href="sync.html">SYNC</a>
                <a href="login.html" class="root">_ROOT</a>
            </nav>
        </div>
        <div class="ticker-wrap">
            <div class="ticker" id="ticker-tape">CONNECTING TO GLOBAL EXCHANGE...</div>
        </div>
    </header>

    <div class="interface">
        
        <!-- LEFT: ORDER BOOK (WALL STREET STYLE) -->
        <div class="col-left">
            <div class="panel fill">
                <div class="p-head"><span>COMMODITY_PRICES</span><span>LIVE_L2</span></div>
                <div class="order-book-container" id="order-book">
                    <!-- JS Fills this -->
                </div>
            </div>
            
            <div class="panel">
                 <div class="p-head"><span>MARKET_VOLATILITY</span></div>
                 <div style="height:100px; background:url('images/image_73eda1.png'); background-size:cover; filter: hue-rotate(-15deg);"></div>
            </div>
        </div>

        <!-- CENTER: VORTEX -->
        <div class="col-center">
            <canvas id="three-canvas"></canvas>
            <div class="overlay-ui">
                MAGNETIC_CONTAINMENT_FIELD<br>
                <span style="font-size:2rem; color:var(--heat)">⚠ UNSTABLE</span>
            </div>
        </div>

        <!-- RIGHT: THE GUTTER & CONTROLS -->
        <div class="col-right">
            <div class="panel">
                <div class="p-head"><span>THERMAL_LOAD</span><span>SEC_02</span></div>
                <div class="metric-box">
                    <div class="big-val" id="temp-val">482°K</div>
                    <div class="heat-bar"><div class="heat-fill" id="temp-bar"></div></div>
                </div>
                <div style="padding:15px; border-top:1px solid #333;">
                    <input type="range" min="0" max="100" value="30" style="width:100%; accent-color:var(--rust); margin-bottom:10px;" id="pressure-slider">
                    <button class="btn-vent" onclick="ventSteam()">EMERGENCY VENT</button>
                </div>
            </div>

            <div class="panel fill">
                <div class="p-head"><span>CITIZEN_NET // THE_GUTTER</span><span style="color:var(--heat)">● LIVE</span></div>
                <div class="feed-container" id="reddit-feed">
                    <!-- Posts go here -->
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. EXTENDED DATA STREAMS ---
        const commodities = [
            { sym: "O2_CAN", name: "Oxygen", price: 450 },
            { sym: "H2O_FLT", name: "Water Filter", price: 1200 },
            { sym: "LEAD_KG", name: "Raw Lead", price: 85 },
            { sym: "GRAV_D", name: "Grav Dampener", price: 5400 },
            { sym: "DATA_S", name: "Clean Data", price: 300 },
            { sym: "MELON", name: "Synth-Melon", price: 45 },
            { sym: "COFFEE", name: "Real Coffee", price: 890 },
            { sym: "HEAT_S", name: "Heat Sink", price: 210 },
            { sym: "V_COIN", name: "Vera Coin", price: 1.05 },
            { sym: "OLD_OS", name: "Legacy Drive", price: 5000 },
            { sym: "BIO_MS", name: "Bio-Mesh", price: 670 },
            { sym: "SLUDGE", name: "Ind. Sludge", price: 12 },
            { sym: "N2_LIQ", name: "Liq Nitrogen", price: 340 },
            { sym: "MEM_FR", name: "Memory Frag", price: 9999 },
            { sym: "VOID_K", name: "Void Key", price: 0 },
            { sym: "PORK_S", name: "Synth Pork", price: 22 },
            { sym: "TUNGST", name: "Tungsten", price: 1500 },
            { sym: "GRAPHN", name: "Graphene", price: 2100 },
            { sym: "RE_H2O", name: "Recycled H2O", price: 15 },
            { sym: "ID_TAG", name: "Blank ID", price: 8000 },
            { sym: "NEURO", name: "Neuro-Link", price: 350 },
            { sym: "COPPER", name: "Copper Wire", price: 65 },
            { sym: "RAD_MD", name: "Anti-Rad", price: 150 },
            { sym: "SILICA", name: "Silicon", price: 90 },
            { sym: "ENERGY", name: "kWh Cell", price: 400 }
        ];

        // --- 2. TICKER LOGIC (SLOWED DOWN) ---
        async function initTicker() {
            let tickerText = "";
            const cryptos = ['bitcoin', 'ethereum', 'solana', 'cardano', 'ripple'];
            try {
                const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${cryptos.join(',')}&vs_currencies=usd`);
                const data = await res.json();
                tickerText += `BTC: $${data.bitcoin.usd} // ETH: $${data.ethereum.usd} // SOL: $${data.solana.usd} // `;
            } catch (e) {
                tickerText += "BTC: $42,050 // ETH: $3,100 // SOL: $105 // "; 
            }
            // Add fictional commodities
            commodities.forEach(c => {
                let p = (c.price + (Math.random() - 0.5) * 10).toFixed(2);
                tickerText += `${c.sym}: ₮${p} // `;
            });
            // Repeat for smooth loop
            document.getElementById('ticker-tape').innerText = tickerText.repeat(5);
        }
        initTicker();

        // --- 3. ORDER BOOK (DENSE & CHAOTIC) ---
        function updateOrderBook() {
            const container = document.getElementById('order-book');
            container.innerHTML = "";
            // Shuffle and show top 15
            const shuffled = commodities.sort(() => 0.5 - Math.random());
            
            shuffled.forEach(c => {
                let p = (c.price + (Math.random() - 0.5) * 5).toFixed(2);
                let up = Math.random() > 0.5;
                let color = up ? "price-up" : "price-down";
                let arrow = up ? "▲" : "▼";
                let vol = Math.floor(Math.random() * 5000);
                
                let row = document.createElement('div');
                row.className = "order-row";
                row.innerHTML = `<span>${c.sym}</span><span class="${color} col-right">${p}</span><span class="col-right" style="color:#666">${vol}</span>`;
                container.appendChild(row);
            });
        }
        setInterval(updateOrderBook, 800); // Fast updates

        // --- 4. REDDIT SCRAPER (THE GUTTER) ---
        const forumUsers = ["Rat_King", "Echo_Loco", "Sloane_Eye", "Market_Rat", "Null_Set", "Vera_Fan", "Lead_Head", "Steam_Junkie", "Void_Walker", "Glitch_Bitch"];
        const forumPosts = [
            "The heat in Sector 4 is unbearable today.",
            "Buying O2 canisters, will trade for clean data.",
            "Did anyone else see the gravity glitch?",
            "My neighbor's door disappeared. Smooth wall now.",
            "Selling 5kg of Lead. No questions asked.",
            "The steam vents are screaming.",
            "Don't look at the Observatory.",
            "Price of Water Filters just doubled.",
            "I found a memory shard in the gutter.",
            "Vera is watching. Always.",
            "The sludge is leaking again.",
            "Has anyone seen Bas? He was here yesterday.",
            "Need a new heat sink for my rig.",
            "Just saw a kid floating in zero-g.",
            "Radiation levels spiking.",
            "Who is buying all the Tungsten?",
            "The bridge isn't for us.",
            "My hands are glitching out.",
            "THERMAL LIMIT EXCEEDED IN SECTOR 9",
            "Anyone want to buy some fresh melon juice?"
        ];

        function addPost() {
            const feed = document.getElementById('reddit-feed');
            const u = forumUsers[Math.floor(Math.random() * forumUsers.length)];
            const p = forumPosts[Math.floor(Math.random() * forumPosts.length)];
            const upvotes = Math.floor(Math.random() * 500);
            
            const item = document.createElement('div');
            item.className = "post";
            item.innerHTML = `
                <div class="post-meta"><span>u/${u}</span><span>[↑${upvotes}]</span></div>
                <div class="post-body">${p}</div>
            `;
            feed.prepend(item);
            if(feed.children.length > 50) feed.lastChild.remove();
        }
        setInterval(addPost, 2000); // New post every 2s
        for(let i=0; i<8; i++) addPost(); 

        // --- 5. 3D VORTEX ---
        let pressure = 30;
        const canvas = document.getElementById('three-canvas');
        const renderer = new THREE.WebGLRenderer({canvas, alpha:true});
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
        camera.position.z = 5;

        const geo = new THREE.CylinderGeometry(1.8, 1.8, 8, 32, 1, true);
        const mat = new THREE.MeshBasicMaterial({ 
            color: 0xea580c, wireframe: true, transparent: true, opacity: 0.4, side: THREE.DoubleSide 
        });
        const vortex = new THREE.Mesh(geo, mat);
        vortex.rotation.x = Math.PI/2;
        scene.add(vortex);

        const core = new THREE.Mesh(new THREE.TorusGeometry(1.5, 0.1, 16, 100), new THREE.MeshBasicMaterial({ color: 0xffffff }));
        scene.add(core);

        function resize() {
            const p = canvas.parentElement;
            renderer.setSize(p.clientWidth, p.clientHeight);
            camera.aspect = p.clientWidth / p.clientHeight;
            camera.updateProjectionMatrix();
        }
        window.addEventListener('resize', resize);
        resize();

        function animate() {
            requestAnimationFrame(animate);
            vortex.rotation.y += 0.001 * pressure;
            core.rotation.x += 0.002 * pressure;
            
            let hue = (pressure / 100) * 0.1; 
            mat.color.setHSL(0.05 + hue, 1, 0.5);

            if(pressure > 85) {
                camera.position.x = (Math.random()-0.5) * 0.1;
                document.body.classList.add('critical');
            } else {
                camera.position.set(0,0,5);
                document.body.classList.remove('critical');
            }
            renderer.render(scene, camera);
            
            document.getElementById('temp-val').innerText = Math.floor(400 + (pressure*4)) + "°K";
            document.getElementById('temp-bar').style.width = pressure + "%";
        }
        animate();

        // --- 6. CONTROLS ---
        const slider = document.getElementById('pressure-slider');
        slider.oninput = (e) => { pressure = parseInt(e.target.value); };

        function ventSteam() {
            pressure = Math.max(10, pressure - 20);
            slider.value = pressure;
        }

    </script>
</body>
</html>

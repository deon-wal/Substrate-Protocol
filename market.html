<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // MARKET_FLUX</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* --- SUBSTRATE THEME: RUST / OCHRE / HEAT --- */
        :root {
            --bg: #0a0500;
            --panel: rgba(20, 10, 5, 0.92);
            --rust: #ea580c;       /* Decay/Structure */
            --ochre: #d97706;      /* Data */
            --heat: #ffedd5;       /* White Hot */
            --alert: #ef4444;      /* Containment Fail */
            --steam: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; user-select: none; }
        
        body { 
            margin: 0; background: var(--bg); color: var(--ochre);
            font-family: 'Share Tech Mono', monospace; overflow: hidden;
            font-size: 13px;
            /* Asset: Market Thumbnail */
            background-image: url('images/market_thumbnail.jpg'); 
            background-size: cover; background-attachment: fixed;
            background-blend-mode: multiply;
        }

        /* --- HEAT HAZE FX --- */
        #heat-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 5;
            backdrop-filter: blur(1px); opacity: 0; transition: opacity 0.5s;
        }
        @keyframes haze {
            0% { transform: translate(0,0) scale(1); }
            50% { transform: translate(-2px, -2px) scale(1.01); filter: hue-rotate(-5deg); }
            100% { transform: translate(0,0) scale(1); }
        }
        body.critical #heat-overlay { opacity: 1; animation: haze 0.1s infinite; }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg); border-left: 1px solid #222; }
        ::-webkit-scrollbar-thumb { background: var(--rust); border: 1px solid #555; }
        ::-webkit-scrollbar-thumb:hover { background: var(--heat); }

        /* --- LAYOUT GRID (CHAOTIC) --- */
        .interface {
            display: grid; grid-template-columns: 350px 1fr 300px;
            grid-template-rows: 60px 1fr auto;
            padding: 100px 30px; gap: 20px; height: 100vh;
            position: relative; z-index: 20;
        }

        /* --- HEADER & TICKER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 80px; z-index: 100;
            background: linear-gradient(180deg, #000 80%, transparent 100%);
            border-bottom: 2px solid var(--rust);
            display: flex; flex-direction: column;
        }
        
        .nav-bar {
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 40px; height: 50px;
        }
        .logo { font-family: 'Rajdhani'; font-size: 1.5rem; letter-spacing: 4px; color: #fff; text-shadow: 0 0 15px var(--rust); }
        
        .nav a { 
            color: #666; text-decoration: none; margin-left: 20px; font-size: 0.8rem; letter-spacing: 2px; transition: 0.3s; 
        }
        .nav a:hover { color: var(--heat); text-shadow: 0 0 10px var(--rust); }
        .nav a.active { color: var(--rust); border-bottom: 1px solid var(--rust); }
        .nav a.root { color: var(--alert); }

        /* LIVE TICKER - SLOWED DOWN TO 120s */
        .ticker-wrap {
            width: 100%; height: 30px; background: rgba(234, 88, 12, 0.1);
            overflow: hidden; display: flex; align-items: center; border-top: 1px solid #333;
        }
        .ticker {
            display: inline-block; white-space: nowrap; padding-left: 100%;
            animation: scroll 120s linear infinite; /* SLOWED DOWN */
            color: var(--heat); font-size: 0.8rem; letter-spacing: 2px; font-weight: bold;
        }
        @keyframes scroll { 100% { transform: translateX(-100%); } }

        /* --- SIDEBARS --- */
        .sidebar { display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding-right: 5px; }
        
        .widget {
            border: 1px solid #311; background: var(--panel); padding: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative;
        }
        .w-header { 
            font-size: 0.7rem; color: #888; border-bottom: 1px dashed var(--rust); 
            padding-bottom: 5px; margin-bottom: 10px; display: flex; justify-content: space-between;
        }

        /* THERMAL GAUGE */
        .temp-display { font-family: 'Rajdhani'; font-size: 3.5rem; font-weight: bold; color: #fff; line-height: 0.9; }
        .temp-bar-container { width: 100%; height: 8px; background: #200; margin-top: 10px; }
        .temp-fill { height: 100%; width: 50%; background: linear-gradient(90deg, var(--rust), var(--alert)); transition: width 0.2s; box-shadow: 0 0 10px var(--rust); }

        /* MARKET GRAPH ASSET */
        .market-vis {
            height: 120px; width: 100%; 
            background: url('images/image_73eda1.png'); /* The red graph asset */
            background-size: cover; background-position: center;
            opacity: 0.8; filter: hue-rotate(-10deg) contrast(1.5);
            border: 1px solid var(--rust);
        }

        /* --- CENTER: THE VORTEX --- */
        .viewport {
            position: relative; border: 1px solid var(--rust);
            background: radial-gradient(circle, #1a0a05 0%, #000 100%);
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        #three-canvas { width: 100%; height: 100%; filter: contrast(1.2); }
        
        .overlay-ui {
            position: absolute; bottom: 20px; left: 20px; pointer-events: none;
            color: var(--heat); font-size: 0.7rem; text-shadow: 0 0 5px var(--rust);
        }

        /* --- LOGS --- */
        .log-feed { display: flex; flex-direction: column; gap: 10px; margin-top: auto; }
        .log-entry {
            background: rgba(0,0,0,0.8); border-left: 3px solid var(--rust); padding: 15px;
            font-size: 0.8rem; color: #bbb; transition: 0.3s;
        }
        .log-entry:hover { background: rgba(234, 88, 12, 0.1); border-left-color: var(--heat); }
        .highlight { color: var(--rust); font-weight: bold; }

        /* BUTTONS */
        .vent-btn {
            width: 100%; background: transparent; border: 1px solid var(--rust); color: var(--rust);
            padding: 15px; font-family: inherit; font-size: 1rem; font-weight: bold; cursor: pointer;
            transition: 0.2s; text-transform: uppercase; margin-top: 10px;
        }
        .vent-btn:hover { background: var(--rust); color: #000; box-shadow: 0 0 20px var(--rust); }

        /* --- LIVE NET FEED (REDDIT BLOB) --- */
        #net-feed {
            position: fixed; bottom: 20px; right: 20px; width: 320px;
            background: rgba(10, 5, 0, 0.95); border: 1px solid var(--rust);
            z-index: 500; font-family: 'Share Tech Mono'; box-shadow: 0 0 40px #000;
        }
        .feed-header {
            background: var(--rust); color: #000; padding: 5px 10px;
            font-weight: bold; font-size: 0.8rem; display: flex; justify-content: space-between;
        }
        .feed-content {
            height: 150px; overflow: hidden; padding: 10px;
            display: flex; flex-direction: column-reverse; /* New items at bottom */
            gap: 8px; font-size: 0.7rem; color: #ccc;
        }
        .feed-item {
            border-bottom: 1px dashed #333; padding-bottom: 5px; opacity: 0; animation: fadeIn 0.3s forwards;
        }
        .user-tag { color: var(--ochre); font-weight: bold; }
        .timestamp { color: #666; float: right; font-size: 0.6rem; }
        
        @keyframes fadeIn { to { opacity: 1; } }

        /* --- STEAM PARTICLES --- */
        .steam-container { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
        .steam-puff {
            position: absolute; background: radial-gradient(circle, rgba(200,200,200,0.2) 0%, transparent 70%);
            width: 100px; height: 100px; border-radius: 50%;
            animation: rise 4s linear forwards;
        }
        @keyframes rise { 
            0% { transform: translateY(0) scale(1); opacity: 0; } 
            20% { opacity: 0.5; } 
            100% { transform: translateY(-300px) scale(3); opacity: 0; } 
        }

    </style>
</head>
<body>

    <div id="heat-overlay"></div>
    <div class="steam-container" id="steam-layer"></div>

    <header>
        <div class="nav-bar">
            <div class="logo">ALDERSYTH // MARKET</div>
            <nav class="nav">
                <a href="index.html">CORE</a>
                <a href="spire.html">SPIRE</a>
                <a href="market.html" class="active">MARKET</a>
                <a href="residential.html">RESIDENTIAL</a>
                <a href="observatory.html">OBSERVATORY</a>
                <a href="sync.html">SYNC</a>
                <a href="login.html" class="root">_ROOT</a>
            </nav>
        </div>
        <!-- LIVE CRYPTO TICKER -->
        <div class="ticker-wrap">
            <div class="ticker" id="crypto-ticker">
                INITIALIZING MARKET STREAM...
            </div>
        </div>
    </header>

    <div class="interface">
        
        <!-- LEFT: THERMODYNAMICS -->
        <aside class="sidebar">
            <div class="widget">
                <div class="w-header"><span>THERMAL_CORE</span><span>SEC_02</span></div>
                <div class="temp-readout" id="temp-val">482°K</div>
                <div class="temp-bar-container"><div class="temp-fill" id="temp-bar"></div></div>
                <div style="margin-top:10px; color:var(--alert); font-size:0.7rem; display:none;" id="warn-msg">
                    ⚠ CRITICAL: CONTAINMENT FAILURE IMMINENT
                </div>
            </div>

            <div class="widget">
                <div class="w-header"><span>PRESSURE_VALVE</span><span>MANUAL</span></div>
                <input type="range" min="0" max="100" value="20" style="width:100%; accent-color:var(--rust);" id="pressure-slider">
                <button class="vent-btn" onclick="ventSteam()">EMERGENCY_VENT</button>
            </div>

            <div class="widget">
                <div class="w-header"><span>MARKET_VOLATILITY</span><span>LIVE</span></div>
                <div class="market-vis"></div>
            </div>
        </aside>

        <!-- CENTER: CONTAINMENT VORTEX -->
        <div class="viewport">
            <canvas id="three-canvas"></canvas>
            <div class="overlay-ui">
                OBJECT: MAGNETIC_BOTTLE<br>
                STATUS: SUPERHEATED<br>
                RPM: <span id="rpm-val">1200</span>
            </div>
        </div>

        <!-- RIGHT: NARRATIVE LOGS -->
        <aside class="sidebar">
            <div class="widget" style="flex:1;">
                <div class="w-header"><span>AUDIO_FEED</span><span>REC</span></div>
                <canvas id="audio-viz" style="width:100%; height:50px; margin-bottom:15px;"></canvas>
                
                <div class="log-feed">
                    <div class="log-entry">
                        <span style="color:#666">[LOG_II]</span> <span class="highlight">THERMODYNAMIC STRESS</span><br><br>
                        High-tensile architecture doesn’t creak like wood—it screams. Thick atmosphere clings to the air, a gooey soup making breathing optional.
                    </div>
                    <div class="log-entry">
                        <span style="color:#666">[SYS_ALERT]</span> <span class="highlight">MAGNETIC FLUX</span><br><br>
                        Levitation nodes sputter. Cabbage heads and crates vibrate violently. Lead blocks weep grey sludge.
                    </div>
                    <div class="log-entry">
                        <span style="color:#666">[VERA]</span><br>
                        "Kael, I am slaving your pulse to the city grid. Maintain the rhythm."
                    </div>
                </div>
            </div>
        </aside>

    </div>

    <!-- LIVE NET FEED (REDDIT BLOB) -->
    <div id="net-feed">
        <div class="feed-header">
            <span>CITIZEN_NET // CHANNEL_7</span>
            <span style="animation:blink 1s infinite">● LIVE</span>
        </div>
        <div class="feed-content" id="feed-list">
            <!-- JS injects comments here -->
        </div>
    </div>

    <script>
        // --- 1. EXTENDED MARKET TICKER ---
        const stocks = [
            "BTC", "ETH", "SOL", "ALDR", "H2O", "O2_CAN", "LEAD", "GRAV", 
            "SLDG", "VERA_SYS", "CORE", "FLUX", "HEAT", "S-NET", "VOID", 
            "NULL", "DATA", "MEM", "BIO_SYNTH", "N_GAS", "CARB_FIB", 
            "MAG_CON", "X-RAY", "Z-AXIS", "TIME"
        ];
        
        async function updateTicker() {
            let tickerText = "";
            
            // Try fetch real BTC
            let btcPrice = "ERROR";
            try {
                const res = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const data = await res.json();
                btcPrice = "$" + Math.floor(data.bpi.USD.rate_float).toLocaleString();
            } catch(e) { btcPrice = "OFFLINE"; }

            // Generate ticker string
            stocks.forEach(s => {
                let price = (Math.random() * 5000).toFixed(2);
                let change = (Math.random() - 0.5) * 10;
                let arrow = change > 0 ? "▲" : "▼";
                if(s === "BTC") price = btcPrice;
                
                tickerText += `${s}: ${price} ${arrow} ${Math.abs(change).toFixed(2)}% // `;
            });

            // Quadruple the string to ensure smooth infinite scroll on wide screens
            const fullText = tickerText + tickerText + tickerText + tickerText;
            document.getElementById('crypto-ticker').innerText = fullText;
        }
        updateTicker();
        // Update prices every 60 seconds, but animation continues smoothly
        setInterval(updateTicker, 60000); 

        // --- 2. LIVE NET FEED (REDDIT BLOB) ---
        const users = ["User_99", "Rat_King", "Echo_Loco", "Null_Set", "Vera_Fan", "Sloane_Eye", "Market_Rat"];
        const comments = [
            "Heat scrubbers are failing in Sector 4 again.",
            "Anyone else see the gravity glitch near the Spire?",
            "Buying O2 canisters, will trade for Lead.",
            "My neighbor vanished. Door is gone too.",
            "The steam vents are screaming louder today.",
            "Don't look at the Observatory.",
            "Data viscosity is up 40%.",
            "I heard a rumor about the bridge...",
            "Just saw a melon float away.",
            "Is it hot in here or just me?"
        ];

        function updateFeed() {
            const list = document.getElementById('feed-list');
            const u = users[Math.floor(Math.random() * users.length)];
            const c = comments[Math.floor(Math.random() * comments.length)];
            
            const item = document.createElement('div');
            item.className = 'feed-item';
            item.innerHTML = `<span class="user-tag">@${u}:</span> ${c} <span class="timestamp">[NOW]</span>`;
            
            list.prepend(item);
            if(list.children.length > 5) list.lastChild.remove();
        }
        // Randomly update feed every 2-5 seconds
        setInterval(updateFeed, 3500);


        // --- 3. 3D VORTEX (The Containment Bottle) ---
        const canvas = document.getElementById('three-canvas');
        const renderer = new THREE.WebGLRenderer({canvas, alpha:true});
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
        camera.position.z = 5;

        // The "Steam/Water" Cylinder
        const geometry = new THREE.CylinderGeometry(1.5, 1.5, 6, 32, 10, true);
        const material = new THREE.MeshBasicMaterial({ 
            color: 0xea580c, 
            wireframe: true, 
            transparent: true, 
            opacity: 0.3,
            side: THREE.DoubleSide
        });
        const vortex = new THREE.Mesh(geometry, material);
        vortex.rotation.x = Math.PI / 2; // Face camera
        scene.add(vortex);

        // Inner Core (White Hot)
        const coreGeo = new THREE.TorusGeometry(1, 0.2, 16, 100);
        const coreMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const core = new THREE.Mesh(coreGeo, coreMat);
        scene.add(core);

        let pressure = 20;
        
        function resize() {
            const cont = canvas.parentElement;
            renderer.setSize(cont.clientWidth, cont.clientHeight);
            camera.aspect = cont.clientWidth / cont.clientHeight;
            camera.updateProjectionMatrix();
        }
        window.addEventListener('resize', resize);
        resize();

        function animate() {
            requestAnimationFrame(animate);
            
            // Rotation based on Pressure
            let speed = pressure * 0.002;
            vortex.rotation.z -= speed;
            core.rotation.x += speed;
            core.rotation.y += speed;

            // Heat Glow
            let hue = 0.05 + (pressure * 0.001); // Red to Yellow
            material.color.setHSL(hue, 1, 0.5);
            
            // Camera Shake at high pressure
            if(pressure > 80) {
                camera.position.x = (Math.random()-0.5) * 0.1;
                camera.position.y = (Math.random()-0.5) * 0.1;
                document.body.classList.add('critical');
                document.getElementById('warn-msg').style.display = 'block';
            } else {
                camera.position.x = 0;
                camera.position.y = 0;
                document.body.classList.remove('critical');
                document.getElementById('warn-msg').style.display = 'none';
            }

            renderer.render(scene, camera);
            
            // Update UI
            document.getElementById('temp-val').innerText = Math.floor(400 + pressure * 4) + "°K";
            document.getElementById('temp-bar').style.width = pressure + "%";
            document.getElementById('rpm-val').innerText = Math.floor(pressure * 120);
        }
        animate();

        // --- 4. INTERACTION ---
        const slider = document.getElementById('pressure-slider');
        slider.oninput = (e) => {
            pressure = e.target.value;
            // Update audio pitch if connected
            if(osc) osc.frequency.value = 100 + (pressure * 5);
        };

        // Venting System
        function ventSteam() {
            // Audio Hiss
            if(audioCtx) {
                const hiss = audioCtx.createOscillator();
                hiss.type = 'sawtooth'; // Rougher sound
                hiss.frequency.value = 800; // High pitch steam
                const g = audioCtx.createGain();
                g.gain.value = 0.1;
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
                hiss.connect(g); g.connect(audioCtx.destination);
                hiss.start(); hiss.stop(audioCtx.currentTime + 1);
            }

            // Visual Particles
            const container = document.getElementById('steam-layer');
            for(let i=0; i<10; i++) {
                const puff = document.createElement('div');
                puff.className = 'steam-puff';
                puff.style.left = (Math.random() * 100) + "%";
                puff.style.bottom = "-50px";
                container.appendChild(puff);
                setTimeout(() => puff.remove(), 4000);
            }

            // Lower Pressure
            pressure = Math.max(10, pressure - 20);
            slider.value = pressure;
        }

        // --- 5. AUDIO ENGINE ---
        let audioCtx, osc;
        document.body.addEventListener('click', () => {
            if(audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'sine'; // Low drone
            osc.frequency.value = 100;
            gain.gain.value = 0.05;
            
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start();
            drawViz();
        }, {once:true});

        function drawViz() {
            const cvs = document.getElementById('audio-viz');
            const ctx = cvs.getContext('2d');
            function loopViz() {
                ctx.clearRect(0,0,300,50);
                ctx.fillStyle = '#ea580c';
                for(let i=0; i<30; i++) {
                    ctx.fillRect(i*10, 50 - (Math.random() * pressure * 0.5), 8, 50);
                }
                requestAnimationFrame(loopViz);
            }
            loopViz();
        }

    </script>
</body>
</html>

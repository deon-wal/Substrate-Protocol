<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // ENTROPY_MARKET</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #030303; 
            --panel: #0a0a0e;
            --border: rgba(255, 255, 255, 0.1);
            --gold: #d4af37;        
            --crimson: #d90d32;     
            --teal: #14b8a6;   
            --text-dim: #666;
        }

        body { 
            background: var(--bg);
            color: var(--text-dim); 
            font-family: 'Share Tech Mono', monospace; 
            margin: 0; 
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-rows: 60px 30px 1fr 30px; 
            font-size: 13px;
        }

        /* --- BACKGROUND FX --- */
        #dust-canvas {
            position: fixed; inset: 0; z-index: -1; opacity: 0.3; pointer-events: none;
        }

        /* --- HEADER --- */
        header {
            background: rgba(5, 5, 5, 0.95);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; z-index: 10;
        }
        .logo { 
            color: var(--gold); font-family: 'Space Mono', monospace; 
            font-weight: 700; letter-spacing: 2px; 
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.3); 
        }
        .nav a { color: #555; text-decoration: none; margin-left: 20px; transition: 0.2s; font-family: 'Space Mono'; }
        .nav a:hover { color: var(--gold); }
        .nav a.active { color: var(--gold); border-bottom: 1px solid var(--gold); }

        /* --- TICKER --- */
        .ticker-wrap { background: #000; border-bottom: 1px solid var(--border); overflow: hidden; display: flex; align-items: center; }
        .ticker { animation: scroll 40s linear infinite; display: flex; white-space: nowrap; }
        .tick-item { margin-right: 40px; color: #555; font-size: 0.75rem; }
        .up { color: var(--teal); } .down { color: var(--crimson); }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- MAIN LAYOUT --- */
        .dashboard {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            overflow: hidden;
        }

        /* LEFT: COMMODITIES */
        .panel { background: rgba(10,10,14,0.6); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .panel-head { padding: 10px; border-bottom: 1px solid var(--border); color: var(--gold); font-weight: bold; background: #08080a; letter-spacing: 1px; }
        
        .asset-row {
            padding: 15px; border-bottom: 1px solid #222; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center; transition: 0.2s;
        }
        .asset-row:hover { background: #151520; color: #fff; padding-left: 18px; }
        .asset-row.active { border-left: 3px solid var(--gold); background: #1a1a22; }
        .sym { display: block; font-weight: bold; font-size: 0.9rem; color: #ddd; font-family: 'Space Mono'; }
        .desc { font-size: 0.65rem; color: #555; }

        /* CENTER: CHART & STORY */
        .center-stage { display: grid; grid-template-rows: 60% 40%; position: relative; }
        
        .chart-box { position: relative; background: radial-gradient(circle at center, #08080a 0%, #000 100%); border-bottom: 1px solid var(--border); }
        #main-chart { width: 100%; height: 100%; }
        .price-overlay { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        .big-price { font-size: 3rem; color: #fff; font-weight: 300; margin: 0; letter-spacing: -1px; }

        /* THE STORY TERMINAL (NARRATIVE + LIVE) */
        .story-feed { 
            padding: 0; background: #020202; overflow-y: auto; 
            font-family: 'Space Mono', monospace; 
        }
        .story-entry {
            padding: 20px; border-bottom: 1px solid #1a1a1a;
            display: flex; gap: 15px; animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        .ts { min-width: 60px; font-size: 0.7rem; color: var(--teal); opacity: 0.8; }
        .log-content h4 { margin: 0 0 5px 0; color: var(--gold); font-size: 0.8rem; text-transform: uppercase; }
        .log-content p { margin: 0; color: #999; font-size: 0.8rem; line-height: 1.5; }
        .highlight { color: #fff; border-bottom: 1px dashed var(--crimson); }

        /* RIGHT: TRADING */
        .order-panel { border-left: 1px solid var(--border); background: var(--panel); display: flex; flex-direction: column; }
        .book-row { display: flex; justify-content: space-between; padding: 4px 15px; font-size: 0.75rem; font-family: monospace; }
        
        .trade-controls { padding: 20px; background: #08080a; border-top: 1px solid var(--border); margin-top: auto; }
        .btn-buy { width: 100%; padding: 15px; background: var(--gold); border: none; font-weight: bold; cursor: pointer; font-family: 'Space Mono'; transition: 0.2s; }
        .btn-buy:hover { background: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        .input-dark { width: 100%; padding: 12px; background: #111; border: 1px solid #333; color: #fff; margin-bottom: 10px; box-sizing: border-box; font-family: monospace; }

        footer { background: #000; border-top: 1px solid var(--border); display: flex; align-items: center; padding: 0 20px; color: #444; font-size: 0.7rem; justify-content: space-between; }
        
        /* FX */
        .glitch-anim { animation: glitch 0.2s cubic-bezier(.25, .46, .45, .94) both; }
        @keyframes glitch { 0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); } 40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); } 80% { transform: translate(2px, -2px); } 100% { transform: translate(0); } }

    </style>
</head>
<body>

    <canvas id="dust-canvas"></canvas>

    <header>
        <div class="logo">ALDERSYTH // MARKET</div>
        <nav class="nav">
            <a href="spire.html">CORE</a>
            <a href="market.html" class="active">MARKET</a>
            <a href="residential.html">RESIDENTIAL</a>
            <a href="observatory.html">OBSERVATORY</a>
            <a href="sync.html">SYNC</a>
            <a href="backdoor.html" style="opacity:0.3;">_ROOT</a>
        </nav>
        <div style="color:var(--gold); font-family:monospace;">BAL: ₮ <span id="balance">42,050.00</span></div>
    </header>

    <div class="ticker-wrap">
        <div class="ticker" id="ticker">
            </div>
    </div>

    <main class="dashboard">
        <aside class="panel">
            <div class="panel-head">SPOT ASSETS</div>
            <div id="asset-list"></div>
        </aside>

        <section class="center-stage">
            <div class="chart-box">
                <div class="price-overlay">
                    <span style="color:#666; font-size:0.8rem;" id="chart-title">BTC / REALITY_INDEX</span>
                    <h1 class="big-price" id="big-price">---</h1>
                </div>
                <canvas id="main-chart"></canvas>
            </div>
            
            <div class="story-feed" id="feed-container">
                <div style="padding:10px 20px; background:#080808; color:#444; font-size:0.7rem; border-bottom:1px solid #222;">
                    > DECRYPTING LOCAL SURVEILLANCE FEED...
                </div>
                </div>
        </section>

        <aside class="order-panel">
            <div class="panel-head">ORDER BOOK (L2)</div>
            <div id="order-book" style="padding:10px 0; flex:1;"></div>
            
            <div class="trade-controls">
                <div style="color:#fff; margin-bottom:5px; font-size:0.7rem;">QUICK TRADE</div>
                <input type="number" id="trade-qty" value="1" class="input-dark">
                <button class="btn-buy" onclick="trade()">EXECUTE ORDER</button>
            </div>
        </aside>
    </main>

    <footer>
        <span>SECTOR STATUS: <span style="color:var(--crimson)">VOLATILE</span></span>
        <span>REALITY ANCHOR: CONNECTED (BTC-USD)</span>
        <span>LATENCY: 14ms</span>
    </footer>

    <script>
        // --- 1. ASSETS CONFIG ---
        const assets = [
            { sym: "BTC-T", name: "REALITY TETHER", price: 0, vol: 1.5, desc: "Anchor Index (Live)" },
            { sym: "ESPRESSO", name: "FINN'S BREW", price: 15.50, vol: 15.0, desc: "Thermodynamically Unstable" },
            { sym: "LDS-03", name: "LEAD SPHERE", price: 1420.00, vol: 4.5, desc: "Metric Dampener Unit" },
            { sym: "V-DRIFT", name: "VECTOR DRIFT", price: 850.50, vol: 35.0, desc: "Raw Coordinate Data" },
            { sym: "MELON", name: "NEON MELON", price: 12.00, vol: 2.0, desc: "Synthesized Nutrient" }
        ];

        let selected = assets[0];
        let chartData = [];
        let walletBalance = 42050.00;
        let canvas = document.getElementById('main-chart');
        let ctx = canvas.getContext('2d');
        let dustCanvas = document.getElementById('dust-canvas');
        let dustCtx = dustCanvas.getContext('2d');
        let particles = [];

        // --- 2. LIVE DATA FETCH ---
        async function getData() {
            try {
                const r = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const d = await r.json();
                const btcPrice = d.bpi.USD.rate_float;
                assets[0].price = btcPrice;
                if(selected === assets[0]) updateDisplay(btcPrice);
            } catch(e) { console.log("Offline / API Error"); }
        }

        // --- 3. VISUALS (Chart & Dust) ---
        function initVisuals() {
            // Resize Canvases
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
            dustCanvas.width = window.innerWidth;
            dustCanvas.height = window.innerHeight;

            // Seed Chart
            let p = 50000;
            for(let i=0; i<100; i++) {
                p += (Math.random()-0.5) * 500;
                chartData.push(p);
            }

            // Seed Dust
            for(let i=0; i<50; i++) {
                particles.push({
                    x: Math.random() * dustCanvas.width,
                    y: Math.random() * dustCanvas.height,
                    v: Math.random() * 0.5 + 0.1,
                    s: Math.random() * 2
                });
            }
        }

        function drawLoop() {
            // --- CHART ---
            let last = chartData[chartData.length-1];
            let volatility = selected === assets[0] ? 0.05 : selected.vol;
            let next = last + (Math.random()-0.5) * volatility;
            
            // Sync BTC drift
            if(selected === assets[0] && assets[0].price !== 0) {
                 let diff = assets[0].price - last;
                 next += diff * 0.1;
            }

            chartData.push(next);
            chartData.shift();

            // Clear
            ctx.fillStyle = "#020202";
            ctx.fillRect(0,0,canvas.width, canvas.height);

            // Line
            let min = Math.min(...chartData);
            let max = Math.max(...chartData);
            let range = max - min || 1;

            ctx.beginPath();
            let color = next > chartData[0] ? "#14b8a6" : "#d90d32";
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;

            for(let i=0; i<chartData.length; i++) {
                let x = (i / (chartData.length-1)) * canvas.width;
                let y = canvas.height - ((chartData[i] - min) / range) * (canvas.height - 80) - 40;
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.stroke();

            // Gradient
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            let grad = ctx.createLinearGradient(0,0,0,canvas.height);
            grad.addColorStop(0, color + "22");
            grad.addColorStop(1, "transparent");
            ctx.fillStyle = grad;
            ctx.fill();

            if(selected !== assets[0] || assets[0].price === 0) updateDisplay(next);
            updateBook(next);

            // --- DUST ---
            dustCtx.clearRect(0,0,dustCanvas.width, dustCanvas.height);
            dustCtx.fillStyle = "#333";
            particles.forEach(p => {
                p.y -= p.v;
                if(p.y < 0) p.y = dustCanvas.height;
                dustCtx.beginPath();
                dustCtx.arc(p.x, p.y, p.s, 0, Math.PI*2);
                dustCtx.fill();
            });
        }

        function updateDisplay(price) {
            const el = document.getElementById('big-price');
            el.innerText = "₮ " + price.toLocaleString(undefined, {minimumFractionDigits: 2});
            el.style.color = price > chartData[0] ? "#14b8a6" : "#d90d32";
            selected.price = price;
        }

        function updateBook(price) {
            const el = document.getElementById('order-book');
            let html = "";
            for(let i=5; i>0; i--) html += `<div class="book-row"><span style="color:var(--crimson)">${(price + i*selected.vol*0.1).toFixed(2)}</span><span>${Math.floor(Math.random()*50)}</span></div>`;
            html += `<div style="border-bottom:1px dashed #333; margin:5px 0;"></div>`;
            for(let i=1; i<=5; i++) html += `<div class="book-row"><span style="color:var(--teal)">${(price - i*selected.vol*0.1).toFixed(2)}</span><span>${Math.floor(Math.random()*50)}</span></div>`;
            el.innerHTML = html;
        }

        // --- 4. LOGIC (Trade & Lore) ---
        function renderAssets() {
            const list = document.getElementById('asset-list');
            list.innerHTML = "";
            assets.forEach(a => {
                let div = document.createElement('div');
                div.className = `asset-row ${a===selected ? 'active' : ''}`;
                div.innerHTML = `<div><span class="sym">${a.sym}</span><span class="desc">${a.desc}</span></div><div style="color:#fff">₮ ${a.price.toFixed(2)}</div>`;
                div.onclick = () => {
                    selected = a;
                    document.getElementById('chart-title').innerText = `${a.sym} / INDEX`;
                    chartData = chartData.map(v => a.price + (Math.random()-0.5)*10);
                    renderAssets();
                };
                list.appendChild(div);
            });
        }

        function trade() {
            const qty = document.getElementById('trade-qty').value;
            const cost = qty * selected.price;
            if(walletBalance >= cost) {
                walletBalance -= cost;
                document.getElementById('balance').innerText = walletBalance.toLocaleString(undefined, {minimumFractionDigits: 2});
                document.body.classList.add('glitch-anim');
                setTimeout(() => document.body.classList.remove('glitch-anim'), 200);
            } else {
                alert("INSUFFICIENT FUNDS IN BRIDGE ACCOUNT");
            }
        }

        // STATIC STORY + DYNAMIC LORE
        const initialLogs = [
            { h: "ANOMALY DETECTED // SECTOR 2", p: "Visual confirmation: <span class='highlight'>Finn's Espresso Cart</span> experienced a localized gravity failure. The ceramic cup launched itself at a pedestrian. Analyst Kael intercepted the object. Thermal damage to palm confirmed." },
            { h: "TRANSCRIPT: LEAD THEORIST SLOANE", p: "Subject refused to acknowledge the casualty risk. Quote: 'The data requires a stress test. If the market collapses, we find the leak. If you catch the cup, you’re just noise in the machine.'" },
            { h: "ALERT // THE BRIDGE DATASET", p: "The 'Strangers' are monitoring the ozone spikes. They are mining the <span class='highlight'>Vector Drift</span> for architectural weaknesses." }
        ];

        const randomLore = [
            "Sector 4 reported a gravity leak. Lead Sphere prices spiking.",
            "Lemonade haze detected in Residential Rings. Wear masks.",
            "The Crow has been spotted near the Observatory pipeworks.",
            "Substrate connection intermittent. Data may arrive from the future.",
            "Metric Shift detected: 4.5 magnitude."
        ];

        function addLog(header, body, timeOverride) {
            const feed = document.getElementById('feed-container');
            const time = timeOverride || new Date().toLocaleTimeString();
            
            const div = document.createElement('div');
            div.className = 'story-entry';
            div.innerHTML = `
                <div class="ts">${time}</div>
                <div class="log-content"><h4>${header}</h4><p>${body}</p></div>
            `;
            feed.prepend(div);
            // Keep specific story logs (bottom) but limit top growth
            if(feed.children.length > 20) feed.children[15].remove();
        }

        // --- INIT ---
        window.onload = () => {
            initVisuals();
            renderAssets();
            getData();
            
            // Load Initial Story (Reverse order so they stack correctly)
            initialLogs.reverse().forEach((l, i) => addLog(l.h, l.p, `12:${45-i}:00`));

            // Ticker Init
            let tHtml = "";
            assets.forEach(a => tHtml += `<div class="tick-item">${a.sym} <span class="up">▲ ${(Math.random()*5).toFixed(1)}%</span></div>`);
            document.getElementById('ticker').innerHTML = tHtml + tHtml;

            // Loops
            setInterval(drawLoop, 50);      // 20FPS
            setInterval(getData, 10000);    // 10s API
            setInterval(renderAssets, 2000); // 2s UI
            
            // Random Lore Injection
            setInterval(() => {
                if(Math.random() > 0.7) {
                    const msg = randomLore[Math.floor(Math.random() * ra<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // MARKET_FLUX</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* --- SUBSTRATE THEME: RUST / OCHRE / HEAT --- */
        :root {
            --bg: #0a0500;
            --panel: rgba(20, 10, 5, 0.92);
            --rust: #ea580c;       /* Decay/Structure */
            --ochre: #d97706;      /* Data */
            --heat: #ffedd5;       /* White Hot */
            --alert: #ef4444;      /* Containment Fail */
            --steam: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; user-select: none; }
        
        body { 
            margin: 0; background: var(--bg); color: var(--ochre);
            font-family: 'Share Tech Mono', monospace; overflow: hidden;
            font-size: 13px;
            /* Asset: Market Thumbnail */
            background-image: url('images/market_thumbnail.jpg'); 
            background-size: cover; background-blend-mode: multiply;
        }

        /* --- HEAT HAZE FX --- */
        #heat-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 5;
            backdrop-filter: blur(1px); opacity: 0; transition: opacity 0.5s;
        }
        @keyframes haze {
            0% { transform: translate(0,0) scale(1); }
            50% { transform: translate(-2px, -2px) scale(1.01); filter: hue-rotate(-5deg); }
            100% { transform: translate(0,0) scale(1); }
        }
        body.critical #heat-overlay { opacity: 1; animation: haze 0.1s infinite; }

        /* --- LAYOUT GRID (CHAOTIC) --- */
        .interface {
            display: grid; grid-template-columns: 350px 1fr 300px;
            grid-template-rows: 60px 1fr auto;
            padding: 100px 30px; gap: 20px; height: 100vh;
            position: relative; z-index: 20;
        }

        /* --- HEADER & TICKER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 80px; z-index: 100;
            background: linear-gradient(180deg, #000 80%, transparent 100%);
            border-bottom: 2px solid var(--rust);
            display: flex; flex-direction: column;
        }
        
        .nav-bar {
            display: flex; justify-content: space-between; align-items: center; 
            padding: 10px 40px; height: 50px;
        }
        .logo { font-family: 'Rajdhani'; font-size: 1.5rem; letter-spacing: 4px; color: #fff; text-shadow: 0 0 15px var(--rust); }
        
        .nav a { 
            color: #666; text-decoration: none; margin-left: 20px; font-size: 0.8rem; letter-spacing: 2px; transition: 0.3s; 
        }
        .nav a:hover { color: var(--heat); text-shadow: 0 0 10px var(--rust); }
        .nav a.active { color: var(--rust); border-bottom: 1px solid var(--rust); }

        /* LIVE TICKER */
        .ticker-wrap {
            width: 100%; height: 30px; background: rgba(234, 88, 12, 0.1);
            overflow: hidden; display: flex; align-items: center; border-top: 1px solid #333;
        }
        .ticker {
            display: inline-block; white-space: nowrap; padding-left: 100%;
            animation: scroll 30s linear infinite; color: var(--heat); font-size: 0.7rem; letter-spacing: 1px;
        }
        @keyframes scroll { 100% { transform: translateX(-100%); } }

        /* --- SIDEBARS --- */
        .sidebar { display: flex; flex-direction: column; gap: 15px; overflow-y: auto; padding-right: 5px; }
        
        .widget {
            border: 1px solid #311; background: var(--panel); padding: 15px;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); position: relative;
        }
        .w-header { 
            font-size: 0.7rem; color: #888; border-bottom: 1px dashed var(--rust); 
            padding-bottom: 5px; margin-bottom: 10px; display: flex; justify-content: space-between;
        }

        /* THERMAL GAUGE */
        .temp-display { font-family: 'Rajdhani'; font-size: 3.5rem; font-weight: bold; color: #fff; line-height: 0.9; }
        .temp-bar-container { width: 100%; height: 8px; background: #200; margin-top: 10px; }
        .temp-fill { height: 100%; width: 50%; background: linear-gradient(90deg, var(--rust), var(--alert)); transition: width 0.2s; box-shadow: 0 0 10px var(--rust); }

        /* MARKET GRAPH ASSET */
        .market-vis {
            height: 120px; width: 100%; 
            background: url('images/image_73eda1.png'); /* The red graph asset */
            background-size: cover; background-position: center;
            opacity: 0.8; filter: hue-rotate(-10deg) contrast(1.5);
            border: 1px solid var(--rust);
        }

        /* --- CENTER: THE VORTEX --- */
        .viewport {
            position: relative; border: 1px solid var(--rust);
            background: radial-gradient(circle, #1a0a05 0%, #000 100%);
            overflow: hidden; display: flex; align-items: center; justify-content: center;
        }
        #three-canvas { width: 100%; height: 100%; filter: contrast(1.2); }
        
        .overlay-ui {
            position: absolute; bottom: 20px; left: 20px; pointer-events: none;
            color: var(--heat); font-size: 0.7rem; text-shadow: 0 0 5px var(--rust);
        }

        /* --- LOGS --- */
        .log-feed { display: flex; flex-direction: column; gap: 10px; margin-top: auto; }
        .log-entry {
            background: rgba(0,0,0,0.8); border-left: 3px solid var(--rust); padding: 15px;
            font-size: 0.8rem; color: #bbb; transition: 0.3s;
        }
        .log-entry:hover { background: rgba(234, 88, 12, 0.1); border-left-color: var(--heat); }
        .highlight { color: var(--rust); font-weight: bold; }

        /* BUTTONS */
        .vent-btn {
            width: 100%; background: transparent; border: 1px solid var(--rust); color: var(--rust);
            padding: 15px; font-family: inherit; font-size: 1rem; font-weight: bold; cursor: pointer;
            transition: 0.2s; text-transform: uppercase; margin-top: 10px;
        }
        .vent-btn:hover { background: var(--rust); color: #000; box-shadow: 0 0 20px var(--rust); }

        /* --- STEAM PARTICLES --- */
        .steam-container { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
        .steam-puff {
            position: absolute; background: radial-gradient(circle, rgba(200,200,200,0.2) 0%, transparent 70%);
            width: 100px; height: 100px; border-radius: 50%;
            animation: rise 4s linear forwards;
        }
        @keyframes rise { 
            0% { transform: translateY(0) scale(1); opacity: 0; } 
            20% { opacity: 0.5; } 
            100% { transform: translateY(-300px) scale(3); opacity: 0; } 
        }

    </style>
</head>
<body>

    <div id="heat-overlay"></div>
    <div class="steam-container" id="steam-layer"></div>

    <header>
        <div class="nav-bar">
            <div class="logo">ALDERSYTH // MARKET</div>
            <nav class="nav">
                <a href="index.html">CORE</a>
                <a href="spire.html">SPIRE</a>
                <a href="market.html" class="active">MARKET</a>
                <a href="residential.html">RESIDENTIAL</a>
                <a href="observatory.html">OBSERVATORY</a>
                <a href="sync.html">SYNC</a>
                <a href="login.html" class="root">_ROOT</a>
            </nav>
        </div>
        <!-- LIVE CRYPTO TICKER -->
        <div class="ticker-wrap">
            <div class="ticker" id="crypto-ticker">
                INITIALIZING MARKET STREAM...
            </div>
        </div>
    </header>

    <div class="interface">
        
        <!-- LEFT: THERMODYNAMICS -->
        <aside class="sidebar">
            <div class="widget">
                <div class="w-header"><span>THERMAL_CORE</span><span>SEC_02</span></div>
                <div class="temp-readout" id="temp-val">482°K</div>
                <div class="temp-bar-container"><div class="temp-fill" id="temp-bar"></div></div>
                <div style="margin-top:10px; color:var(--alert); font-size:0.7rem; display:none;" id="warn-msg">
                    ⚠ CRITICAL: CONTAINMENT FAILURE IMMINENT
                </div>
            </div>

            <div class="widget">
                <div class="w-header"><span>PRESSURE_VALVE</span><span>MANUAL</span></div>
                <input type="range" min="0" max="100" value="20" style="width:100%; accent-color:var(--rust);" id="pressure-slider">
                <button class="vent-btn" onclick="ventSteam()">EMERGENCY_VENT</button>
            </div>

            <div class="widget">
                <div class="w-header"><span>MARKET_VOLATILITY</span><span>LIVE</span></div>
                <div class="market-vis"></div>
            </div>
        </aside>

        <!-- CENTER: CONTAINMENT VORTEX -->
        <div class="viewport">
            <canvas id="three-canvas"></canvas>
            <div class="overlay-ui">
                OBJECT: MAGNETIC_BOTTLE<br>
                STATUS: SUPERHEATED<br>
                RPM: <span id="rpm-val">1200</span>
            </div>
        </div>

        <!-- RIGHT: NARRATIVE LOGS -->
        <aside class="sidebar">
            <div class="widget" style="flex:1;">
                <div class="w-header"><span>AUDIO_FEED</span><span>REC</span></div>
                <canvas id="audio-viz" style="width:100%; height:50px; margin-bottom:15px;"></canvas>
                
                <div class="log-feed">
                    <div class="log-entry">
                        <span style="color:#666">[LOG_II]</span> <span class="highlight">THERMODYNAMIC STRESS</span><br><br>
                        High-tensile architecture doesn’t creak like wood—it screams. Thick atmosphere clings to the air, a gooey soup making breathing optional.
                    </div>
                    <div class="log-entry">
                        <span style="color:#666">[SYS_ALERT]</span> <span class="highlight">MAGNETIC FLUX</span><br><br>
                        Levitation nodes sputter. Cabbage heads and crates vibrate violently. Lead blocks weep grey sludge.
                    </div>
                    <div class="log-entry">
                        <span style="color:#666">[VERA]</span><br>
                        "Kael, I am slaving your pulse to the city grid. Maintain the rhythm."
                    </div>
                </div>
            </div>
        </aside>

    </div>

    <script>
        // --- 1. REAL MARKET TICKER ---
        async function updateTicker() {
            try {
                const res = await fetch('https://api.coindesk.com/v1/bpi/currentprice.json');
                const data = await res.json();
                const btc = data.bpi.USD.rate;
                const txt = `BTC: $${btc} // ETH: $3,204.12 // ALDER_COIN: ERROR // DATA_VISCOSITY: 98% // THERMAL_LIMIT: EXCEEDED // `;
                document.getElementById('crypto-ticker').innerText = txt + txt + txt; // Repeat for loop
            } catch(e) {
                document.getElementById('crypto-ticker').innerText = "CONNECTION LOST... RETRYING...";
            }
        }
        updateTicker();
        setInterval(updateTicker, 60000);

        // --- 2. 3D VORTEX (The Containment Bottle) ---
        const canvas = document.getElementById('three-canvas');
        const renderer = new THREE.WebGLRenderer({canvas, alpha:true});
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
        camera.position.z = 5;

        // The "Steam/Water" Cylinder
        const geometry = new THREE.CylinderGeometry(1.5, 1.5, 6, 32, 10, true);
        const material = new THREE.MeshBasicMaterial({ 
            color: 0xea580c, 
            wireframe: true, 
            transparent: true, 
            opacity: 0.3,
            side: THREE.DoubleSide
        });
        const vortex = new THREE.Mesh(geometry, material);
        vortex.rotation.x = Math.PI / 2; // Face camera
        scene.add(vortex);

        // Inner Core (White Hot)
        const coreGeo = new THREE.TorusGeometry(1, 0.2, 16, 100);
        const coreMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const core = new THREE.Mesh(coreGeo, coreMat);
        scene.add(core);

        let pressure = 20;
        
        function resize() {
            const cont = canvas.parentElement;
            renderer.setSize(cont.clientWidth, cont.clientHeight);
            camera.aspect = cont.clientWidth / cont.clientHeight;
            camera.updateProjectionMatrix();
        }
        window.addEventListener('resize', resize);
        resize();

        function animate() {
            requestAnimationFrame(animate);
            
            // Rotation based on Pressure
            let speed = pressure * 0.002;
            vortex.rotation.z -= speed;
            core.rotation.x += speed;
            core.rotation.y += speed;

            // Heat Glow
            let hue = 0.05 + (pressure * 0.001); // Red to Yellow
            material.color.setHSL(hue, 1, 0.5);
            
            // Camera Shake at high pressure
            if(pressure > 80) {
                camera.position.x = (Math.random()-0.5) * 0.1;
                camera.position.y = (Math.random()-0.5) * 0.1;
                document.body.classList.add('critical');
                document.getElementById('warn-msg').style.display = 'block';
            } else {
                camera.position.x = 0;
                camera.position.y = 0;
                document.body.classList.remove('critical');
                document.getElementById('warn-msg').style.display = 'none';
            }

            renderer.render(scene, camera);
            
            // Update UI
            document.getElementById('temp-val').innerText = Math.floor(400 + pressure * 4) + "°K";
            document.getElementById('temp-bar').style.width = pressure + "%";
            document.getElementById('rpm-val').innerText = Math.floor(pressure * 120);
        }
        animate();

        // --- 3. INTERACTION ---
        const slider = document.getElementById('pressure-slider');
        slider.oninput = (e) => {
            pressure = e.target.value;
            // Update audio pitch if connected
            if(osc) osc.frequency.value = 100 + (pressure * 5);
        };

        // Venting System
        function ventSteam() {
            // Audio Hiss
            if(audioCtx) {
                const hiss = audioCtx.createOscillator();
                hiss.type = 'sawtooth'; // Rougher sound
                hiss.frequency.value = 800; // High pitch steam
                const g = audioCtx.createGain();
                g.gain.value = 0.1;
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
                hiss.connect(g); g.connect(audioCtx.destination);
                hiss.start(); hiss.stop(audioCtx.currentTime + 1);
            }

            // Visual Particles
            const container = document.getElementById('steam-layer');
            for(let i=0; i<10; i++) {
                const puff = document.createElement('div');
                puff.className = 'steam-puff';
                puff.style.left = (Math.random() * 100) + "%";
                puff.style.bottom = "-50px";
                container.appendChild(puff);
                setTimeout(() => puff.remove(), 4000);
            }

            // Lower Pressure
            pressure = Math.max(10, pressure - 20);
            slider.value = pressure;
        }

        // --- 4. AUDIO ENGINE ---
        let audioCtx, osc;
        document.body.addEventListener('click', () => {
            if(audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'sine'; // Low drone
            osc.frequency.value = 100;
            gain.gain.value = 0.05;
            
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start();
            drawViz();
        }, {once:true});

        function drawViz() {
            const cvs = document.getElementById('audio-viz');
            const ctx = cvs.getContext('2d');
            function loopViz() {
                ctx.clearRect(0,0,300,50);
                ctx.fillStyle = '#ea580c';
                for(let i=0; i<30; i++) {
                    ctx.fillRect(i*10, 50 - (Math.random() * pressure * 0.5), 8, 50);
                }
                requestAnimationFrame(loopViz);
            }
            loopViz();
        }

    </script>
</body>
</html>ndomLore.length)];
                    addLog("WIRE_SERVICE // UPDATE", msg);
                }
            }, 8000);
        };
        
        window.onresize = initVisuals;

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // ENTROPY_EXCHANGE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root { 
            /* THEME: Obsidian / Gold / Crimson */
            --bg: #030303; 
            --panel: #0a0a0e;
            --border: rgba(255, 255, 255, 0.08);
            
            --gold: #d4af37;        
            --gold-dim: #6b5c2b;
            --crimson: #d90d32;     
            --teal: #14b8a6;        
            
            --scanline: rgba(0,0,0,0.5);
        }

        /* --- LAYOUT & SCROLL --- */
        body { 
            background: var(--bg);
            color: #888; 
            font-family: 'Space Mono', monospace; 
            margin: 0; 
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-rows: 50px 30px 1fr 30px; 
            font-size: 12px;
        }

        /* --- CANVAS BACKGROUND --- */
        #dust-canvas {
            position: fixed; inset: 0; z-index: -1; opacity: 0.4; pointer-events: none;
        }

        /* --- HEADER --- */
        header {
            background: rgba(5, 5, 5, 0.9);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px;
            backdrop-filter: blur(4px);
            z-index: 10;
        }
        .logo { color: var(--gold); font-weight: 700; letter-spacing: 2px; text-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
        .nav a { color: #555; text-decoration: none; margin-left: 20px; transition: 0.2s; }
        .nav a:hover { color: var(--teal); }
        .nav a.active { color: var(--gold); border-bottom: 1px solid var(--gold); }
        
        .wallet-box {
            border: 1px solid #333; padding: 5px 15px; color: #eee; background: #000;
            font-family: monospace; display: flex; gap: 15px;
        }

        /* --- TICKER --- */
        .ticker-wrap {
            background: #000; border-bottom: 1px solid var(--border);
            overflow: hidden; display: flex; align-items: center; white-space: nowrap;
        }
        .ticker { animation: scroll 40s linear infinite; display: flex; }
        .tick-item { margin-right: 40px; color: #444; font-size: 0.7rem; }
        .tick-val { font-weight: bold; margin-left: 5px; }
        .up { color: var(--teal); } .down { color: var(--crimson); }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- MAIN GRID --- */
        .dashboard {
            display: grid;
            grid-template-columns: 260px 1fr 300px;
            overflow: hidden;
        }

        /* LEFT: COMMODITIES */
        .panel { background: rgba(10,10,14,0.6); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .panel-head { 
            padding: 10px; border-bottom: 1px solid var(--border); 
            font-size: 0.7rem; color: var(--gold-dim); background: #08080a; 
            letter-spacing: 1px; font-weight: bold;
        }
        
        .asset-list { overflow-y: auto; flex: 1; }
        .asset-row {
            padding: 12px 15px; border-bottom: 1px solid #151518; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center; transition: 0.2s;
        }
        .asset-row:hover { background: #151520; color: #fff; }
        .asset-row.active { border-left: 2px solid var(--gold); background: #1a1a22; }
        .sym { display: block; color: #ddd; font-weight: bold; font-size: 0.8rem; }
        .name { font-size: 0.65rem; color: #555; display: block; }

        /* CENTER: CHART & LORE */
        .center-stage { display: grid; grid-template-rows: 2fr 1fr; position: relative; }
        
        .chart-container { position: relative; background: #050505; border-bottom: 1px solid var(--border); }
        #main-chart { width: 100%; height: 100%; }
        .chart-overlay {
            position: absolute; top: 20px; left: 20px; pointer-events: none;
        }
        .price-big { font-size: 2.5rem; color: #fff; margin: 0; font-weight: 300; }
        .volatility-tag { 
            display: inline-block; padding: 2px 6px; border: 1px solid var(--crimson); 
            color: var(--crimson); font-size: 0.6rem; margin-top: 5px; opacity: 0;
        }

        /* LORE TERMINAL */
        .lore-term { 
            background: #000; padding: 15px; overflow-y: auto; 
            font-family: 'Courier New', monospace; font-size: 0.75rem; color: #666;
            border-top: 1px solid var(--border);
        }
        .log-entry { margin-bottom: 8px; border-left: 2px solid #333; padding-left: 8px; }
        .log-time { color: var(--teal); font-size: 0.65rem; margin-right: 5px; }

        /* RIGHT: ORDER BOOK */
        .order-panel { border-left: 1px solid var(--border); display: flex; flex-direction: column; background: var(--panel); }
        .order-book { flex: 1; overflow: hidden; padding: 5px 0; }
        .book-row { 
            display: flex; justify-content: space-between; padding: 3px 15px; 
            font-size: 0.7rem; font-family: monospace; color: #555;
        }
        .spread-line { border-bottom: 1px dashed #333; margin: 5px 0; }

        .trade-controls { 
            padding: 20px; background: #08080a; border-top: 1px solid var(--border); 
        }
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .qty-input { 
            background: #111; border: 1px solid #333; color: #fff; padding: 10px; 
            width: 100%; font-family: inherit; text-align: right; 
        }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { 
            border: none; padding: 12px; cursor: pointer; font-weight: bold; font-family: inherit; 
            transition: 0.2s; color: #000;
        }
        .btn-buy { background: var(--teal); }
        .btn-sell { background: var(--crimson); color: #fff; }
        .btn:hover { opacity: 0.8; letter-spacing: 1px; }

        /* --- FOOTER --- */
        footer {
            background: #000; border-top: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; color: #444; font-size: 0.65rem; z-index: 10;
        }

        /* --- FX --- */
        .glitch-anim { animation: glitch 0.3s cubic-bezier(.25, .46, .45, .94) both infinite; }
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        .flash-red { animation: flashR 0.2s; }
        @keyframes flashR { 0% { background: rgba(217, 13, 50, 0.3); } }

    </style>
</head>
<body>

    <canvas id="dust-canvas"></canvas>

    <header>
        <div class="logo">ALDERSYTH // MARKET</div>
        <nav class="nav">
    <a href="spire.html">CORE</a> 
    
    <a href="market.html">MARKET</a>
    <a href="residential.html">RESIDENTIAL</a>
    <a href="observatory.html">OBSERVATORY</a>
    
    <a href="sync.html">SYNC</a> 
    
    <a href="backdoor.html" style="opacity:0.3;">_ROOT</a> 
</nav>
        <div class="wallet-box">
            <span>BAL: ₮ <span id="wallet-val">42,050.00</span></span>
        </div>
    </header>

    <div class="ticker-wrap">
        <div class="ticker" id="ticker-feed">
            </div>
    </div>

    <main class="dashboard">
        
        <aside class="panel">
            <div class="panel-head">SPOT MARKETS</div>
            <div class="asset-list" id="asset-list">
                </div>
            <div style="padding:15px; border-top:1px solid #222; font-size:0.65rem; color:#444;">
                <span style="color:var(--crimson);">WARNING:</span> Trading physics artifacts (Lead Spheres) carries risk of temporal dilation.
            </div>
        </aside>

        <section class="center-stage">
            <div class="chart-container">
                <div class="chart-overlay">
                    <h1 class="price-big" id="main-price">---</h1>
                    <div style="color:#666; font-size:0.8rem;" id="main-name">SELECT ASSET</div>
                    <span class="volatility-tag" id="vol-alert">HIGH VOLATILITY DETECTED</span>
                </div>
                <canvas id="main-chart"></canvas>
            </div>
            
            <div class="lore-term" id="lore-feed">
                <div style="color:var(--gold-dim); margin-bottom:10px;">// SYSTEM_MESSAGES_LOG //</div>
                </div>
        </section>

        <aside class="order-panel">
            <div class="panel-head">ORDER BOOK (L2)</div>
            <div class="order-book" id="order-book">
                </div>
            
            <div class="trade-controls">
                <div class="input-row">
                    <input type="number" class="qty-input" id="trade-qty" value="1" min="1">
                </div>
                <div class="btn-grid">
                    <button class="btn btn-buy" onclick="trade('BUY')">BUY</button>
                    <button class="btn btn-sell" onclick="trade('SELL')">SELL</button>
                </div>
            </div>
        </aside>

    </main>

    <footer>
        <span>SECTOR 7 STATUS: <span style="color:var(--crimson);">UNSTABLE</span></span>
        <span>METRIC SHIFT: 12%</span>
        <span>UPTIME: 99.9%</span>
    </footer>

    <script>
        // --- DATA & CONFIG ---
        const assets = [
            { sym: "LDS-03", name: "LEAD SPHERE (3KG)", price: 1420.00, vol: 8.0, desc: "Standard unit for metric dampening." },
            { sym: "V-DRIFT", name: "VECTOR DRIFT RAW", price: 850.50, vol: 15.0, desc: "Unstable coordinate data." },
            { sym: "SLUDGE", name: "SUB-STRATA WASTE", price: 42.00, vol: 2.0, desc: "Viscous grey metallic runoff." },
            { sym: "O-GAMI", name: "ORIGAMI FRAGMENT", price: 4200.00, vol: 25.0, desc: "Architectural debris. Folding hazard." },
            { sym: "MELON", name: "NEON MELON JUICE", price: 12.50, vol: 1.0, desc: "Synthesized nutrient paste." },
            { sym: "STAB-X", name: "STABILIZER UNIT", price: 15000.00, vol: 50.0, desc: "Prevents gravity leaks." }
        ];

        const loreSnippets = [
            "Vera is watching from the Gantry. Keep trades silent.",
            "Sector 4 reported a gravity leak. Lead Sphere prices spiking.",
            "Structural Analyst Kael reported glitching edges on the walkway.",
            "Lemonade haze detected in Residential Rings. Wear masks.",
            "The Crow has been spotted near the Observatory pipeworks.",
            "Substrate connection intermittent. Data may arrive from the future."
        ];

        let selected = assets[0];
        let wallet = 42050.00;
        let chartPoints = [];
        let canvas, ctx, dustCanvas, dustCtx;
        let particles = [];

        // --- INIT ---
        function init() {
            // Chart Setup
            canvas = document.getElementById('main-chart');
            ctx = canvas.getContext('2d');
            resize();
            window.addEventListener('resize', resize);

            // Dust Setup
            dustCanvas = document.getElementById('dust-canvas');
            dustCtx = dustCanvas.getContext('2d');
            initParticles();

            // Logic
            renderAssets();
            changeAsset(assets[0]);
            startTicker();
            
            // Loops
            setInterval(gameLoop, 50);     // 20fps visuals
            setInterval(updateData, 1000); // 1s data tick
            setInterval(addLore, 8000);    // 8s lore drop
            
            addLore(); // Initial
        }

        // --- VISUALS: CHART & PARTICLES ---
        function resize() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
            dustCanvas.width = window.innerWidth;
            dustCanvas.height = window.innerHeight;
        }

        function initParticles() {
            for(let i=0; i<50; i++) {
                particles.push({
                    x: Math.random() * window.innerWidth,
                    y: Math.random() * window.innerHeight,
                    s: Math.random() * 2,
                    v: Math.random() * 0.5
                });
            }
        }

        function drawDust() {
            dustCtx.clearRect(0,0,dustCanvas.width, dustCanvas.height);
            dustCtx.fillStyle = "#333";
            particles.forEach(p => {
                p.y -= p.v;
                if(p.y < 0) p.y = window.innerHeight;
                dustCtx.beginPath();
                dustCtx.arc(p.x, p.y, p.s, 0, Math.PI*2);
                dustCtx.fill();
            });
        }

        function drawChart() {
            // Shift data
            let last = chartPoints[chartPoints.length-1];
            // Random walk
            let next = last + (Math.random()-0.5) * selected.vol;
            chartPoints.push(next);
            chartPoints.shift();

            // Draw
            ctx.fillStyle = "#050505";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            ctx.beginPath();
            let min = Math.min(...chartPoints);
            let max = Math.max(...chartPoints);
            let range = max - min || 1;
            
            let color = next > chartPoints[0] ? "#14b8a6" : "#d90d32";
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;

            for(let i=0; i<chartPoints.length; i++) {
                let x = (i/(chartPoints.length-1)) * canvas.width;
                let y = canvas.height - ((chartPoints[i] - min) / range) * (canvas.height - 60) - 30;
                if(i===0) ctx.moveTo(x,y);
                else ctx.lineTo(x,y);
            }
            ctx.stroke();

            // Gradient fill
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            let grad = ctx.createLinearGradient(0,0,0,canvas.height);
            grad.addColorStop(0, color + "22"); // Hex + alpha
            grad.addColorStop(1, "#00000000");
            ctx.fillStyle = grad;
            ctx.fill();

            // Update UI
            document.getElementById('main-price').innerText = "₮ " + next.toFixed(2);
            document.getElementById('main-price').style.color = color;
            
            // Volatility Warning
            let volEl = document.getElementById('vol-alert');
            volEl.style.opacity = Math.abs(next - chartPoints[0]) > (selected.vol * 10) ? 1 : 0;
            
            // Update Asset Price in memory
            selected.price = next;
        }

        function gameLoop() {
            drawChart();
            drawDust();
        }

        // --- LOGIC ---
        function changeAsset(asset) {
            selected = asset;
            document.getElementById('main-name').innerText = asset.name;
            // Regen chart history
            chartPoints = [];
            let p = asset.price;
            for(let i=0; i<200; i++) {
                p += (Math.random()-0.5) * asset.vol;
                chartPoints.push(p);
            }
            renderAssets();
            renderBook();
        }

        function renderAssets() {
            const list = document.getElementById('asset-list');
            list.innerHTML = "";
            assets.forEach(a => {
                let div = document.createElement('div');
                div.className = `asset-row ${a === selected ? 'active' : ''}`;
                div.innerHTML = `
                    <div><span class="sym">${a.sym}</span><span class="name">${a.name}</span></div>
                    <div style="font-family:monospace;">₮ ${a.price.toFixed(2)}</div>
                `;
                div.onclick = () => changeAsset(a);
                list.appendChild(div);
            });
        }

        function renderBook() {
            const book = document.getElementById('order-book');
            let html = "";
            let p = selected.price;
            // Asks
            for(let i=5; i>0; i--) {
                html += `<div class="book-row"><span style="color:var(--crimson)">₮ ${(p+(i*selected.vol*0.1)).toFixed(2)}</span><span>${Math.floor(Math.random()*100)}</span></div>`;
            }
            html += `<div class="spread-line"></div>`;
            // Bids
            for(let i=1; i<=5; i++) {
                html += `<div class="book-row"><span style="color:var(--teal)">₮ ${(p-(i*selected.vol*0.1)).toFixed(2)}</span><span>${Math.floor(Math.random()*100)}</span></div>`;
            }
            book.innerHTML = html;
        }

        function updateData() {
            // Random walk all assets
            assets.forEach(a => {
                if(a !== selected) a.price += (Math.random()-0.5) * a.vol;
            });
            renderAssets();
            renderBook();
        }

        function addLore() {
            const feed = document.getElementById('lore-feed');
            const msg = loreSnippets[Math.floor(Math.random() * loreSnippets.length)];
            const time = new Date().toLocaleTimeString();
            
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerHTML = `<span class="log-time">[${time}]</span> ${msg}`;
            feed.prepend(div);
            
            // Keep limit
            if(feed.children.length > 20) feed.lastChild.remove();
        }

        function startTicker() {
            const t = document.getElementById('ticker-feed');
            let html = "";
            [...assets, ...assets].forEach(a => {
                html += `<div class="tick-item">${a.sym} <span class="tick-val ${Math.random()>0.5?'up':'down'}">${(Math.random()*5).toFixed(1)}%</span></div>`;
            });
            t.innerHTML = html;
        }

        function trade(type) {
            const qty = parseInt(document.getElementById('trade-qty').value);
            const total = qty * selected.price;
            
            if(type === 'BUY') {
                if(wallet >= total) {
                    wallet -= total;
                    flash("up");
                } else return alert("INSUFFICIENT FUNDS");
            } else {
                wallet += total;
                flash("down");
            }
            document.getElementById('wallet-val').innerText = wallet.toLocaleString(undefined, {minimumFractionDigits: 2});
            
            // Visual Glitch on Trade
            document.body.classList.add('glitch-anim');
            setTimeout(() => document.body.classList.remove('glitch-anim'), 300);
        }

        function flash(dir) {
            // simple visual feedback could go here
        }

        init();

    </script>
</body>
</html>

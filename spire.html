<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALDERSYTH // MARKET_DISTRICT</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #030303; 
            --panel: #0a0a0e;
            --border: rgba(255, 255, 255, 0.08);
            --gold: #d4af37;        
            --gold-dim: #6b5c2b;
            --crimson: #d90d32;     
            --teal: #14b8a6;        
        }

        body { 
            background: var(--bg);
            color: #888; 
            font-family: 'Space Mono', monospace; 
            margin: 0; 
            height: 100vh;
            overflow: hidden;
            display: grid;
            grid-template-rows: 50px 30px 1fr 25px; 
            font-size: 12px;
        }

        /* --- BACKGROUND PARTICLES --- */
        #dust-canvas { position: fixed; inset: 0; z-index: -1; opacity: 0.4; pointer-events: none; }

        /* --- HEADER --- */
        header {
            background: rgba(5, 5, 5, 0.95);
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; z-index: 10;
        }
        .logo { color: var(--gold); font-weight: 700; letter-spacing: 2px; text-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
        .nav a { color: #555; text-decoration: none; margin-left: 20px; transition: 0.2s; }
        .nav a:hover { color: var(--teal); }
        .nav a.active { color: var(--gold); border-bottom: 1px solid var(--gold); }
        .wallet { border: 1px solid #333; padding: 5px 15px; color: #eee; background: #000; }

        /* --- TICKER --- */
        .ticker-wrap { background: #000; border-bottom: 1px solid var(--border); overflow: hidden; display: flex; align-items: center; }
        .ticker { animation: scroll 40s linear infinite; display: flex; white-space: nowrap; }
        .tick-item { margin-right: 40px; color: #444; font-size: 0.7rem; }
        .up { color: var(--teal); } .down { color: var(--crimson); }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- MAIN LAYOUT --- */
        .dashboard {
            display: grid;
            grid-template-columns: 260px 1fr 300px;
            overflow: hidden;
        }

        /* LEFT: COMMODITIES */
        .panel { background: rgba(10,10,14,0.6); border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .panel-head { padding: 10px; border-bottom: 1px solid var(--border); font-size: 0.7rem; color: var(--gold-dim); background: #08080a; font-weight: bold; }
        .asset-list { overflow-y: auto; flex: 1; }
        .asset-row {
            padding: 12px 15px; border-bottom: 1px solid #151518; cursor: pointer;
            display: flex; justify-content: space-between; transition: 0.2s;
        }
        .asset-row:hover { background: #151520; color: #fff; }
        .asset-row.active { border-left: 2px solid var(--gold); background: #1a1a22; }
        .sym { display: block; color: #ddd; font-weight: bold; font-size: 0.8rem; }

        /* CENTER: CHART */
        .center-stage { display: grid; grid-template-rows: 1fr 150px; position: relative; }
        .chart-container { position: relative; background: #050505; border-bottom: 1px solid var(--border); }
        #main-chart { width: 100%; height: 100%; }
        .chart-overlay { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        .price-big { font-size: 2.5rem; color: #fff; margin: 0; font-weight: 300; }

        /* NEWS FEED (The Narrative Layer) */
        .news-feed { padding: 15px; background: #000; overflow-y: auto; border-top: 1px solid var(--border); }
        .news-item { margin-bottom: 10px; font-size: 0.75rem; color: #666; border-left: 2px solid #333; padding-left: 10px; }
        .news-highlight { color: var(--teal); }

        /* RIGHT: TRADING */
        .order-panel { border-left: 1px solid var(--border); display: flex; flex-direction: column; background: var(--panel); }
        .trade-controls { padding: 20px; background: #08080a; border-top: 1px solid var(--border); margin-top: auto; }
        .qty-input { background: #111; border: 1px solid #333; color: #fff; padding: 10px; width: 100%; margin-bottom: 10px; }
        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { border: none; padding: 12px; cursor: pointer; font-weight: bold; color: #000; transition: 0.2s; }
        .btn-buy { background: var(--teal); } .btn-sell { background: var(--crimson); color: #fff; }
        .btn:hover { opacity: 0.8; }

        /* FOOTER */
        footer { background: #000; border-top: 1px solid var(--border); display: flex; justify-content: space-between; padding: 0 20px; align-items: center; color: #444; font-size: 0.65rem; }
    </style>
</head>
<body>

    <canvas id="dust-canvas"></canvas>

    <header>
        <div class="logo">ALDERSYTH // MARKET</div>
        <nav class="nav">
            <a href="index.html">CORE</a>
            <a href="market.html" class="active">EXCHANGE</a>
            <a href="residential.html">RESIDENTIAL</a>
            <a href="observatory.html">OBSERVATORY</a>
        </nav>
        <div class="wallet">BAL: ₮ <span id="wallet-val">42,050.00</span></div>
    </header>

    <div class="ticker-wrap"><div class="ticker" id="ticker-feed"></div></div>

    <main class="dashboard">
        <aside class="panel">
            <div class="panel-head">COMMODITIES</div>
            <div class="asset-list" id="asset-list"></div>
        </aside>

        <section class="center-stage">
            <div class="chart-container">
                <div class="chart-overlay">
                    <h1 class="price-big" id="main-price">---</h1>
                    <div style="color:#666;" id="main-name">SELECT ASSET</div>
                </div>
                <canvas id="main-chart"></canvas>
            </div>
            <div class="news-feed" id="news-feed">
                <div style="color:var(--gold); margin-bottom:8px; font-weight:bold;">// MARKET_NEWS_WIRE</div>
                </div>
        </section>

        <aside class="order-panel">
            <div class="panel-head">ORDER BOOK (L2)</div>
            <div id="order-book" style="flex:1; overflow:hidden; padding:10px;"></div>
            <div class="trade-controls">
                <input type="number" class="qty-input" id="trade-qty" value="1" min="1">
                <div class="btn-grid">
                    <button class="btn btn-buy" onclick="trade('BUY')">BUY</button>
                    <button class="btn btn-sell" onclick="trade('SELL')">SELL</button>
                </div>
            </div>
        </aside>
    </main>

    <footer>
        <span>STATUS: VOLATILE</span>
        <span>LATENCY: 12ms</span>
    </footer>

    <script>
        // CONFIG
        const assets = [
            { sym: "LDS-03", name: "LEAD SPHERE (3KG)", price: 1420.00, vol: 5.0 },
            { sym: "V-DRIFT", name: "VECTOR DRIFT RAW", price: 850.50, vol: 8.0 },
            { sym: "SLUDGE", name: "SUB-STRATA WASTE", price: 42.00, vol: 1.5 },
            { sym: "O-GAMI", name: "ORIGAMI FRAGMENT", price: 4200.00, vol: 20.0 },
            { sym: "ESPRESSO", name: "FINN'S BREW (HOT)", price: 15.00, vol: 0.5 }
        ];

        const newsItems = [
            "Log 02: Finn's espresso cart reported 88% drift deviation.",
            "Market volatility spike detected in Sector 04.",
            "Sloane: 'The data requires a stress test.'",
            "Thermodynamic stress critical in lower market rings.",
            "Visual anomaly detected: Steam freezing mid-air."
        ];

        let selected = assets[0];
        let wallet = 42050.00;
        let chartData = [];
        let canvas, ctx;

        // INIT
        function init() {
            canvas = document.getElementById('main-chart');
            ctx = canvas.getContext('2d');
            window.addEventListener('resize', resize);
            resize();
            
            renderAssets();
            renderNews();
            changeAsset(assets[0]);
            
            // Ticker
            const t = document.getElementById('ticker-feed');
            let html = "";
            [...assets, ...assets].forEach(a => html += `<div class="tick-item">${a.sym} <span class="up">▲ ${(Math.random()*5).toFixed(2)}%</span></div>`);
            t.innerHTML = html;

            setInterval(gameLoop, 50); // Chart loop
            setInterval(updateSim, 1000); // Data loop
        }

        function resize() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;
        }

        // VISUALS
        function gameLoop() {
            // Shift Chart
            let last = chartData[chartData.length-1] || selected.price;
            let next = last + (Math.random()-0.5) * selected.vol;
            chartData.push(next);
            if(chartData.length > canvas.width/5) chartData.shift();
            
            // Draw
            ctx.fillStyle = "#050505";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            ctx.beginPath();
            let min = Math.min(...chartData);
            let max = Math.max(...chartData);
            let range = max - min || 1;
            
            let color = next > chartData[0] ? "#14b8a6" : "#d90d32";
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;

            for(let i=0; i<chartData.length; i++) {
                let x = (i/(chartData.length-1)) * canvas.width;
                let y = canvas.height - ((chartData[i] - min) / range) * (canvas.height - 100) - 50;
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.stroke();
            
            // Update Text
            document.getElementById('main-price').innerText = "₮ " + next.toFixed(2);
            document.getElementById('main-price').style.color = color;
            selected.price = next;
        }

        // LOGIC
        function changeAsset(a) {
            selected = a;
            document.getElementById('main-name').innerText = a.name;
            chartData = [a.price];
            renderAssets();
            renderBook();
        }

        function renderAssets() {
            const list = document.getElementById('asset-list');
            list.innerHTML = "";
            assets.forEach(a => {
                let div = document.createElement('div');
                div.className = `asset-row ${a === selected ? 'active' : ''}`;
                div.innerHTML = `<div><span class="sym">${a.sym}</span></div><div>₮ ${a.price.toFixed(2)}</div>`;
                div.onclick = () => changeAsset(a);
                list.appendChild(div);
            });
        }

        function renderNews() {
            const feed = document.getElementById('news-feed');
            newsItems.forEach(n => {
                let div = document.createElement('div');
                div.className = "news-item";
                div.innerText = "> " + n;
                feed.appendChild(div);
            });
        }

        function renderBook() {
            const book = document.getElementById('order-book');
            let html = "";
            let p = selected.price;
            for(let i=0; i<5; i++) html += `<div style="display:flex; justify-content:space-between; color:#d90d32; font-size:0.7rem; margin-bottom:2px;"><span>₮ ${(p+i+1).toFixed(2)}</span><span>${Math.floor(Math.random()*50)}</span></div>`;
            html += `<hr style="border:0; border-top:1px dashed #333; margin:5px 0;">`;
            for(let i=0; i<5; i++) html += `<div style="display:flex; justify-content:space-between; color:#14b8a6; font-size:0.7rem; margin-bottom:2px;"><span>₮ ${(p-i-1).toFixed(2)}</span><span>${Math.floor(Math.random()*50)}</span></div>`;
            book.innerHTML = html;
        }

        function updateSim() {
            assets.forEach(a => { if(a!==selected) a.price += (Math.random()-0.5)*a.vol; });
            renderAssets();
            renderBook();
        }

        function trade(type) {
            const qty = parseInt(document.getElementById('trade-qty').value);
            const cost = qty * selected.price;
            if(type === 'BUY') {
                if(wallet >= cost) wallet -= cost; else return alert("NO FUNDS");
            } else wallet += cost;
            document.getElementById('wallet-val').innerText = wallet.toLocaleString(undefined, {minimumFractionDigits: 2});
        }

        init();
    </script>
</body>
</html>
